!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Movai=n():e.Movai=n()}(global,(function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=18)}([function(e,n){e.exports=require("@babel/runtime-corejs3/helpers/esm/defineProperty")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/json/stringify")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/map")},function(e,n){e.exports=require("@babel/runtime-corejs3/helpers/esm/classCallCheck")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/concat")},function(e,n){e.exports=require("@babel/runtime-corejs3/regenerator")},function(e,n){e.exports=require("jwt-decode")},function(e,n){e.exports=require("monet")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/includes")},function(e,n){e.exports=require("@babel/runtime-corejs3/helpers/esm/asyncToGenerator")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/for-each")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/promise")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/set-interval")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/slice")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/url-search-params")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/url")},function(e,n){e.exports=require("@babel/runtime-corejs3/core-js-stable/set-timeout")},function(e,n){e.exports=require("@babel/runtime-corejs3/helpers/esm/createClass")},function(e,n,t){"use strict";t.r(n);var o,r=t(5),i=t.n(r),c=t(1),a=t.n(c),s=t(9),l=t.n(s),u=t(4),h=t.n(u),d=t(6),f=t.n(d),v=""===window.location.port?"http://".concat(window.location.hostname):h()(o="http://".concat(window.location.hostname,":")).call(o,window.location.port),b={AuthException:function(e){this.message=e,this.name="AuthException"},getToken:function(){var e=window.localStorage.getItem("movai.token");return e||!1},getRefreshToken:function(){var e=window.localStorage.getItem("movai.refreshToken");return e||!1},getTokenData:function(){var e=getToken();return{message:f()(e).message,auth_token:!1,refresh_token:getRefreshToken(),error:!1,access_token:e}}};b.login=function(){var e=l()(i.a.mark((function e(n,t,o){var r,c,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session"),(r={})["Content-Type"]="application/json",c="".concat(v,"/token-auth/"),e.prev=7,e.next=10,fetch(c,{method:"POST",headers:r,body:a()({username:n,password:t,remember:o})});case 10:return s=e.sent,l=s.status,e.next=14,s.json();case 14:return u=e.sent,200===l&&(window.localStorage.setItem("movai.token",u.access_token),window.localStorage.setItem("movai.refreshToken",u.refresh_token),window.localStorage.setItem("movai.tokenRemember","undefined"!=o&&o),window.sessionStorage.setItem("movai.session",!0)),e.abrupt("return",u);case 19:throw e.prev=19,e.t0=e.catch(7),e.t0;case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(n,t,o){return e.apply(this,arguments)}}(),b.logout=function(){window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session")},b.checkLogin=l()(i.a.mark((function e(){var n,t,o,r,c,s,l,u,h,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.localStorage.getItem("movai.token"),t=window.localStorage.getItem("movai.refreshToken"),o=window.localStorage.getItem("movai.tokenRemember"),r=window.sessionStorage.getItem("movai.session"),null!==n&&null!==t){e.next=6;break}return e.abrupt("return",!1);case 6:c=null,e.prev=7,c=f()(n),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return",!1);case 14:if(!(c.exp>(new Date).getTime()/1e3)){e.next=16;break}return e.abrupt("return",!0);case 16:if("false"!=o||null!==r){e.next=19;break}return logout(),e.abrupt("return",!1);case 19:if(!t){e.next=41;break}if(e.prev=20,!(f()(t).exp<(new Date).getTime()/1e3)){e.next=24;break}throw"refresh token has expired";case 24:return s="".concat(v,"/token-refresh/"),l={"Content-Type":"application/json"},e.next=28,fetch(s,{method:"POST",headers:l,body:a()({token:t})});case 28:return u=e.sent,h=u.status,e.next=32,u.json();case 32:if(d=e.sent,200!==h){e.next=37;break}return window.localStorage.setItem("movai.token",d.access_token),window.localStorage.setItem("movai.refreshToken",d.refresh_token),e.abrupt("return",!0);case 37:e.next=41;break;case 39:e.prev=39,e.t1=e.catch(20);case 41:return e.abrupt("return",!1);case 42:case"end":return e.stop()}}),e,null,[[7,11],[20,39]])})));var p=b,m=t(10),g=t.n(m),w=t(2),k=t.n(w),S=t(7),_={ofNull:function(e){return S.Maybe.fromNull(e)},range:function(e,n){for(var t,o=k()(t=S.Maybe.fromNull(n)).call(t,(function(t){return{i:e,e:n}})).orSome({i:0,e:e}),r=o.i,i=o.e,c=[],a=r;a<i;a++)c.push(a);return c},randomInt:function(e,n){return Math.floor(_.random(e,n))},random:function(e,n){var t,o=k()(t=S.Maybe.fromNull(n)).call(t,(function(t){return{init:e,end:n}})).orSome({init:0,end:e}),r=o.init;return r+(o.end-r)*Math.random()},normalizeStr:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},groupBy:function(e,n){var t={};return g()(e).call(e,(function(e){var o=n(e);t[o]||(t[o]=[]),t[o].push(e)})),t}},j=_,y=t(11),T=t.n(y),x=t(8),I=t.n(x),E=t(3),A=t.n(E),P=t(0),O=t.n(P),C=t(12),M=t.n(C),R=t(13),q=t.n(R),D=t(14),N=t.n(D),z=t(15),B=t.n(z),V=t(16),H=t.n(V),U=t(17),W=t.n(U),F=p.checkLogin,L=p.getToken,G=p.AuthException,J=function(){function e(n){var t=this,o=n.url,r=void 0===o?this.wsUrl:o,i=n.onOpen,c=void 0===i?null:i,a=n.onClose,s=void 0===a?null:a,l=n.onError,u=void 0===l?null:l,h=n.onMessage,d=void 0===h?null:h,f=n.connectionHandler,v=void 0===f?null:f;A()(this,e),O()(this,"_onOpen",(function(e){console.log("Socket Open: ",e)})),O()(this,"_onClose",(function(e){console.log("Socket Close: ",e),t.connected=!1,t.socket=null,t.timerId&&clearTimeout(t.timerId),t.timerId=H()((function(){t.createSocket()}),5e3)})),O()(this,"_onError",(function(e){t.connected=!1,console.log("Socket Error: ",e)})),O()(this,"_onMessage",(function(e){console.log("Socket Message: ",e)})),O()(this,"_connectionHandler",(function(e){console.log("Invalid Token, no handler specified! ",e)})),this.onOpen=null===c?this._onOpen:c,this.onClose=null===s?this._onClose:s,this.onError=null===u?this._onError:u,this.onMessage=null===d?this._onMessage:d,this.connectionHandler=null===v?this._connectionHandler:v,this.wsUrl=r,this.socket=!1,this.timerId=!1,this.connected=!1}return W()(e,[{key:"createSocket",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;F().then((function(o){var r;if(!o)throw new G("login error");n=!1!==n?n:e.wsUrl;var i=new B.a(n),c=new N.a(q()(r=i.search).call(r,1));c.set("token",L()),i.search=c,(t=new WebSocket(i.toString())).onopen=e.onOpen,t.onerror=e.onError,t.onclose=e.onClose,t.onmessage=e.onMessage,e.socket=t})).catch((function(n){"AuthException"===n.name&&e.connectionHandler(!1)}))}},{key:"send",value:function(e){var n=this;F().then((function(t){if(!t)throw new G("login error");n.socket.send(e)})).catch((function(t){switch(t.name){case"AuthException":n.connectionHandler(!1);break;case"InvalidStateError":var o=n,r=void 0;r=M()((function(){1===o.socket.readyState&&(clearInterval(r),o.socket.send(e))}),400,r)}}))}},{key:"close",value:function(){this.socket&&(this.socket.close(),clearTimeout(this.timerId),this.connected=!1)}}]),e}(),K=p.getToken,Q=p.AuthException,X=p.checkLogin,Y=function e(){var n,t=this;A()(this,e),O()(this,"connect",(function(){t.websocket=new J({url:t.WS_API,onOpen:t.onOpen,onClose:t.onClose,onError:t.onError,onMessage:t.onMessage,connectionHandler:null}),t.websocket.createSocket()})),O()(this,"onOpen",(function(e){t.dispatch("onopen",void 0)})),O()(this,"onClose",(function(e){t.dispatch("onclose",void 0),1e3!==e.code&&window.setTimeout(t.connect(),t.timeout)})),O()(this,"onMessage",(function(e){var n,o;try{o=JSON.parse(e.data)}catch(e){return void console.error(e)}if(o.error)console.error(o.error);else{var r=o.patterns,i=!0,c=!1;I()(n=["list","unsubscribe","subscribe"]).call(n,o.event)&&(r=k()(r).call(r,(function(e){return"unsubscribe"===o.event&&delete t.callbacks[a()(e)],o.event+"/"+a()(e)})),"list"===o.event&&(r=["list"]),i=!1,c=!0),k()(r).call(r,(function(e){t.dispatch(e,o,i,c)}))}})),O()(this,"checkTest",(function(e,n,o,r){return new T.a((function(i,c){t.dispatch(e,n,o,r),i("DONE")}))})),O()(this,"onError",(function(e){t.dispatch("onerror",void 0)})),O()(this,"onEvent",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t.evt_callbacks[e]=t.evt_callbacks[e]||[],t.evt_callbacks[e].push(n)})),O()(this,"close",(function(){return t.websocket.close()})),O()(this,"subscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r={event:"subscribe",pattern:e},i=a()(e);t.callbacks[i]=t.callbacks[i]||[],t.callbacks[i].push(n),o&&(t.evt_callbacks["subscribe/"+i]=t.evt_callbacks["subscribe"+i]||[],t.evt_callbacks["subscribe/"+i].push(o)),t._send(r)})),O()(this,"unsubscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;console.log("Unsubscribe called "+a()(e));var o={event:"unsubscribe",pattern:e},r=a()(e);n&&(t.evt_callbacks["unsubscribe/"+r]=t.evt_callbacks["unsubscribe/"+r]||[],t.evt_callbacks["unsubscribe/"+r].push(n)),t._send(o)})),O()(this,"list",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n={event:"list"};t.evt_callbacks.list=t.evt_callbacks.list||[],t.evt_callbacks.list.push(e),t._send(n)})),O()(this,"_send",(function(e){t.websocket.send(a()(e))})),O()(this,"dispatch",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=void 0,c=e;if(!0===o?(c=a()(e),i=t.callbacks[c]):i=t.evt_callbacks[c],void 0!==i){for(var s=0;s<i.length;s++)"function"==typeof i[s]&&i[s](n);i&&!0===r&&(i=[])}})),O()(this,"getVar",(function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";if(!I()(n=["global","fleet"]).call(n,r))throw"Only fleet and global scopes available.";if("fleet"===r&&e.split("@").length<2)throw"Wrong key format (robot_name@key_name)";var i=t.REST_API+"Var/"+r+"/"+e+"/";X().then((function(e){fetch(i).then((function(e){return e.json()})).then((function(e){o&&o(e)}))}))})),O()(this,"setVar",(function(e,n){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";if(!I()(o=["global","fleet"]).call(o,i))throw"Only fleet and global scopes available.";if("fleet"===i){e.split("@");if(e.split("@").length<2)throw"Wrong key format (robot_name@key_name)"}var c={key:e,scope:i,value:n},s=t.REST_API+"Var/";X().then((function(e){if(!e)throw new Q("login error");fetch(s,{method:"POST",body:a()(c),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){r&&r(e)}))}))})),O()(this,"post",(function(e,n,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=t.REST_API+e+"/"+n+"/";void 0===n&&(c=t.REST_API+e+"/"),X().then((function(e){if(!e)throw new Q("login error");fetch(c,{method:"POST",body:a()({key:o,data:r}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){i&&e.json().then((function(n){i(n,e)}))}))}))})),O()(this,"upload",(function(e,n,o){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,c=h()(r="".concat(t.REST_API,"upload/")).call(r,e,"/"),a=new FormData;a.append("name",n),a.append("data",o),fetch(c,{method:"POST",body:a}).then((function(e){return e.json()})).then(i)})),O()(this,"put",(function(e,n,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=t.REST_API+e+"/"+n+"/";console.log("database put",i),void 0===n&&(i=t.REST_API+e+"/"),X().then((function(e){if(!e)throw new Q("login error");fetch(i,{method:"PUT",body:a()(o),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){r&&e.json().then((function(n){r(n,e)})).catch((function(n){r(void 0,e)}))}))}))})),O()(this,"delete",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.REST_API+e+"/"+n+"/";void 0!==n?X().then((function(e){if(!e)throw new Q("login error");fetch(i,{method:"DELETE",body:a()(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){o&&e.json().then((function(n){o(n,e)})).catch((function(n){o(void 0,e)}))}))})):i=t.REST_API+e+"/"})),O()(this,"cloudFunction",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;X().then((function(i){if(!i)throw new Q("login error");var c=t.REST_API+"function/"+e+"/";fetch(c,{method:"POST",body:a()({func:n,args:o}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){r&&e.json().then((function(e){return r(e)}))}))}))})),O()(this,"postTabs",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r="User",i=t.REST_API+r+"/"+e+"/";if(void 0!==e){var c=k()(n).call(n,(function(e){return{componentName:e.componentName,name:e.name}})),s={Workspace:"*"};X().then((function(e){fetch(i,{method:"POST",body:a()({key:s,data:c}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K())}}).then((function(e){o&&e.json().then((function(n){o(n,e)})).catch((function(n){o(void 0,e)}))}))}))}else i=t.REST_API+r+"/"})),this.host=h()(n="".concat(window.location.hostname,":")).call(n,window.location.port),this.WS_API="ws://"+this.host+"/ws/subscriber",this.REST_API="http://"+this.host+"/api/v1/",this.callbacks={},this.evt_callbacks={},this.timeout=3e3,this.websocket=void 0,this.connect()},Z=function e(){if(A()(this,e),$)return $;$=this,this.db=new Y};O()(Z,"subscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;(new Z).db.subscribe(e,n,t)})),O()(Z,"unsubscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;(new Z).db.unsubscribe(e,n)})),O()(Z,"list",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;(new Z).db.list(e)})),O()(Z,"post",(function(e,n,t,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;(new Z).db.post(e,n,t,o,r)})),O()(Z,"upload",(function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;(new Z).db.post(e,n,t,o)})),O()(Z,"put",(function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;(new Z).db.put(e,n,t,o)})),O()(Z,"delete",(function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(new Z).db.delete(e,n,t,o)})),O()(Z,"cloudFunction",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;(new Z).db.cloudFunction(e,n,t,o)})),O()(Z,"getVar",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";(new Z).db.getVar(e,n,t)})),O()(Z,"setVar",(function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";(new Z).db.setVar(e,n,t,o)}));var $=null,ee=Z;t.d(n,"Authentication",(function(){return p})),t.d(n,"Utils",(function(){return j})),t.d(n,"Database",(function(){return Y})),t.d(n,"MasterDB",(function(){return ee})),t.d(n,"AuthWebSocket",(function(){return J}))}])}));