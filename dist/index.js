!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Movai=t():e.Movai=t()}(self,(function(){return(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AuthWebSocket:()=>S,Authentication:()=>s,BROADCAST_EVENTS:()=>u,BaseModel:()=>ue,BroadcastChannel:()=>y,Clipboard:()=>re,DataManagerBase:()=>he,Database:()=>ee,Document:()=>Qe,MasterDB:()=>j,Rest:()=>G,RobotManager:()=>q,Snapshot:()=>Ce,Style:()=>te,UndoManager:()=>ne,User:()=>ce,Utils:()=>p,WSSub:()=>R,Workspace:()=>ke});const n=require("@babel/runtime/helpers/esm/asyncToGenerator");var o=e.n(n);const A=require("@babel/runtime/regenerator");var r=e.n(A);const c=require("jwt-decode");var i=e.n(c),a={AuthException:function(e){this.message=e,this.statusText=e,this.name="AuthException"},getToken:function(){return window.localStorage.getItem("movai.token")||!1},getRefreshToken:function(){return window.localStorage.getItem("movai.refreshToken")||!1},getTokenData:function(){try{var e=a.getToken();return{message:i()(e).message,auth_token:!1,refresh_token:a.getRefreshToken(),error:!1,access_token:e}}catch(e){return{message:{},error:!0}}}};a.login=function(){var e=o()(r().mark((function e(t,n,o){var A,c,i,a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session"),(A={})["Content-Type"]="application/json",e.prev=7,e.next=10,fetch("/token-auth/",{method:"POST",headers:A,body:JSON.stringify({username:t,password:n,remember:o})});case 10:if(c=e.sent,i=c.status,!(a=c.headers.get("content-type"))||!a.includes("application/json")){e.next=20;break}return e.next=17,c.json();case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0={error:c.statusText};case 21:return s=e.t0,200===i&&(window.localStorage.setItem("movai.token",s.access_token),window.localStorage.setItem("movai.refreshToken",s.refresh_token),window.localStorage.setItem("movai.tokenRemember","undefined"!=o&&o),window.sessionStorage.setItem("movai.session",!0)),e.abrupt("return",s);case 26:return e.prev=26,e.t1=e.catch(7),e.abrupt("return",{error:e.t1.toString()});case 29:case"end":return e.stop()}}),e,null,[[7,26]])})));return function(t,n,o){return e.apply(this,arguments)}}(),a.logout=function(e){window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session"),window.location.replace(e||window.location.origin)},a.checkLogin=o()(r().mark((function e(){var t,n,o,A,c,s,u,h,l,g;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.localStorage.getItem("movai.token"),n=window.localStorage.getItem("movai.refreshToken"),o=window.localStorage.getItem("movai.tokenRemember"),A=window.sessionStorage.getItem("movai.session"),null!==t&&null!==n){e.next=6;break}return e.abrupt("return",!1);case 6:c=null,e.prev=7,c=i()(t),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return",!1);case 14:if(!(c.exp>(new Date).getTime()/1e3)){e.next=16;break}return e.abrupt("return",!0);case 16:if("false"!=o||null!==A){e.next=19;break}return a.logout(),e.abrupt("return",!1);case 19:if(!n){e.next=48;break}if(e.prev=20,!(i()(n).exp<(new Date).getTime()/1e3)){e.next=24;break}throw"refresh token has expired";case 24:return s={"Content-Type":"application/json"},e.next=28,fetch("/token-refresh/",{method:"POST",headers:s,body:JSON.stringify({token:n})});case 28:if(u=e.sent,h=u.status,!(l=u.headers.get("content-type"))||!l.includes("application/json")){e.next=38;break}return e.next=35,u.json();case 35:e.t1=e.sent,e.next=39;break;case 38:e.t1=null;case 39:if(g=e.t1,200!==h||!g){e.next=44;break}return window.localStorage.setItem("movai.token",g.access_token),window.localStorage.setItem("movai.refreshToken",g.refresh_token),e.abrupt("return",!0);case 44:e.next=48;break;case 46:e.prev=46,e.t2=e.catch(20);case 48:return e.abrupt("return",!1);case 49:case"end":return e.stop()}}),e,null,[[7,11],[20,46]])})));const s=a;var u={ISOPEN:"ISOPEN",RPL_ISOPEN:"RPL-ISOPEN",OPENDOC:"OPENDOC",RPL_OPENDOC:"RPL-OPENDOC"};const h=require("@babel/runtime/helpers/esm/toConsumableArray");var l=e.n(h);const g=require("@babel/runtime/helpers/esm/classCallCheck");var d=e.n(g);const f=require("@babel/runtime/helpers/esm/defineProperty");var B=e.n(f);const E=require("@babel/runtime/helpers/esm/typeof");var v=e.n(E);const w=require("monet");var b={ofNull:function(e){return w.Maybe.fromNull(e)},getter:function(e){return function(t){return t[e]}},dot:function(e){return function(t){return function(n){return e(t(n))}}},maybeGet:function(e){return b.dot(b.ofNull)(b.getter(e))},range:function(e,t){for(var n=w.Maybe.fromNull(t).map((function(n){return{i:e,e:t}})).orSome({i:0,e}),o=n.i,A=n.e,r=[],c=o;c<A;c++)r.push(c);return r},randomInt:function(e,t){return Math.floor(b.random(e,t))},random:function(e,t){var n=w.Maybe.fromNull(t).map((function(n){return{init:e,end:t}})).orSome({init:0,end:e}),o=n.init;return o+(n.end-o)*Math.random()},normalizeStr:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},groupBy:function(e,t){var n={};return e.forEach((function(e){var o=t(e);n[o]||(n[o]=[]),n[o].push(e)})),n},capitalize:function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},mod:function(e,t){return(e%t+t)%t},flattenObject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(e).reduce((function(n,o){var A=t.length?t+".":"";return"object"===v()(e[o])?Object.assign(n,b.flattenObject(e[o],A+o)):n[A+o]=e[o],n}),{})},randomGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}};const p=b,y=function e(t){var n=this;d()(this,e),B()(this,"subscribe",(function(e,t){var o=n.subscribed_events[e]||[];n.subscribed_events[e]=[].concat(l()(o),[t]),console.log("BroadcastChannel subscribe to",e)})),B()(this,"unsubscribe",(function(e){n.subscribed_events.hasOwnProperty(e)&&(delete n.subscribed_events[e],console.log("BroadcastChannel unsubscribe to",e))})),B()(this,"postMessage",(function(e){var t=e.event,o=e.target,A=e.data;console.log("BroadcastChannel postMessage to",o),n.instance.postMessage({msgId:p.randomGuid(),event:t,source:n.appName,target:o,data:A||{}})})),B()(this,"close",(function(){n.instance.close(),console.log("BroadcastChannel close for",n.appName)})),B()(this,"_onMessage",(function(e){var t=e.data;n.subscribed_events.hasOwnProperty(t.event)&&t.target===n.appName&&(n.subscribed_events[t.event].forEach((function(e){e(t)})),console.log("BroadcastChannel _onMessage from",t.source))})),this.appName=t,this.subscribed_events={},this.instance=new window.BroadcastChannel("channel"),this.instance.onmessage=this._onMessage,console.log("BroadcastChannel start for",this.appName)},m=require("@babel/runtime/helpers/esm/createClass");var I=e.n(m),M=s.checkLogin,Q=s.getToken,k=s.AuthException,S=function(){function e(t){var n=this,o=t.url,A=void 0===o?this.wsUrl:o,r=t.onOpen,c=void 0===r?null:r,i=t.onClose,a=void 0===i?null:i,s=t.onError,u=void 0===s?null:s,h=t.onMessage,l=void 0===h?null:h,g=t.connectionHandler,f=void 0===g?null:g;d()(this,e),B()(this,"_onOpen",(function(e){console.log("Socket Open: ",e)})),B()(this,"_onClose",(function(e){console.log("Socket Close: ",e),n.connected=!1,n.socket=null,n.timerId&&clearTimeout(n.timerId),n.timerId=setTimeout((function(){n.createSocket()}),5e3)})),B()(this,"_onError",(function(e){n.connected=!1,console.log("Socket Error: ",e)})),B()(this,"_onMessage",(function(e){console.log("Socket Message: ",e)})),B()(this,"_connectionHandler",(function(e){console.log("Invalid Token, no handler specified! ",e)})),this.onOpen=null===c?this._onOpen:c,this.onClose=null===a?this._onClose:a,this.onError=null===u?this._onError:u,this.onMessage=null===l?this._onMessage:l,this.connectionHandler=null===f?this._connectionHandler:f,this.wsUrl=A,this.socket=!1,this.timerId=!1,this.connected=!1}return I()(e,[{key:"createSocket",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!1;M().then((function(o){if(!o)throw new k("login error");t=!1!==t?t:e.wsUrl;var A=new URL(t),r=new URLSearchParams(A.search.slice(1));r.set("token",Q()),A.search=r,(n=new WebSocket(A.toString())).onopen=e.onOpen,n.onerror=e.onError,n.onclose=e.onClose,n.onmessage=e.onMessage,e.socket=n})).catch((function(t){"AuthException"===t.name&&e.connectionHandler(!1)}))}},{key:"send",value:function(e){var t=this;M().then((function(n){if(!n)throw new k("login error");t.socket.send(e)})).catch((function(n){switch(n.name){case"AuthException":t.connectionHandler(!1);break;case"InvalidStateError":var o=t,A=void 0;A=setInterval((function(){1===o.socket.readyState&&(clearInterval(A),o.socket.send(e))}),400,A)}}))}},{key:"close",value:function(){this.socket&&(this.socket.close(),clearTimeout(this.timerId),this.connected=!1)}}]),e}();function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var T=s.getToken,D=s.AuthException,O=s.checkLogin,U=3;const R=function e(){var t=this;d()(this,e),B()(this,"fetchTimeout",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return Promise.race([fetch(e,t),new Promise((function(e,t){return setTimeout((function(){t(new Error("Timeout"))}),n)}))])})),B()(this,"getState",(function(){var e,n;return(null===(e=t.websocket)||void 0===e||null===(n=e.socket)||void 0===n?void 0:n.readyState)||WebSocket.CLOSED})),B()(this,"initSocket",(function(){if(t.websocket)return t;t.status=1;var e=t.url,n=t.onOpen,o=t.onClose,A=t.onError,r=t.onMessage,c=t.onAuthError;return t.websocket=new S({url:e,onOpen:n,onClose:o,onError:A,onMessage:r,connectionHandler:c}),t.connect(),t})),B()(this,"connect",(function(){return t.status=2,t.websocket.createSocket(),t})),B()(this,"reConnect",(function(){var e=2;[e,U].includes(t.status)||(t.status=e,setTimeout(t.connect,t.RECONN_TIMEOUT))})),B()(this,"getOrCreate",(function(e,t){return e.get(t)||e.set(t,[]).get(t)})),B()(this,"pushCallback",(function(e,n,o){return t.getOrCreate(e,n).push(o),t})),B()(this,"addSubscriberCallback",(function(e,n){return"function"!=typeof e?t:t.pushCallback(t.sub_callbacks,n,e)})),B()(this,"addEventCallback",(function(e,n,o){if("function"!=typeof n)return t;var A=o?"/".concat(o):"",r="".concat(e).concat(A);return t.pushCallback(t.evt_callbacks,r,n)})),B()(this,"send",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{if(n>=t.RETRIES)throw new Error("Timeout sending message");t.getState()!==WebSocket.OPEN?setTimeout(t.send,t.RESEND_TIMEOUT,e,n+1):t.websocket.send(JSON.stringify(e))}catch(e){console.error(e)}})),B()(this,"dispatch",(function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0,A=n?t.evt_callbacks:t.sub_callbacks,r=A.get(e)||[];r.forEach((function(e){setTimeout(e,0,o)})),n&&A.delete(e)})),B()(this,"fmtMessage",(function(e,t){return{event:e,pattern:t}})),B()(this,"onOpen",(function(e){t.status=U,t.reSubscribe(),t.dispatch("onopen")})),B()(this,"onClose",(function(e){t.dispatch("onclose"),t.status=4,e.code!==t.NORMAL_CLOSE_EVT&&t.reConnect()})),B()(this,"onError",(function(e){t.dispatch("onerror")})),B()(this,"onAuthError",(function(){t.reConnect()})),B()(this,"onMessage",(function(e){try{var n=JSON.parse(e.data);if(n.error)throw new Error(n.error);var o=n.event,A=Object.values(t.commands).includes(o),r=t.commands;([r.LIST,r.EXECUTE].includes(o)?[o]:n.patterns).forEach((function(e){var r=A?"".concat(o,"/"):"",c="".concat(r).concat(JSON.stringify(e));t.dispatch(c,A,n)}))}catch(e){console.error(e)}})),B()(this,"offlineValidation",(function(e){var n=e.onOnline,o=void 0===n?t.onOnline:n,A=e.onOffline,r=void 0===A?t.onOffline:A;return t.onOnline=o,t.onOffline=r,clearInterval(t.connectionCheckTimeout),t.connectionCheckTimeout=setInterval(t.checkConnection,t.RECONN_VALIDATION_TIMEOUT),t})),B()(this,"retryConnection",(function(){var e=t.checkConnection();return clearInterval(t.connectionCheckTimeout),t.connectionCheckTimeout=setInterval(t.checkConnection,t.RECONN_VALIDATION_TIMEOUT),e})),B()(this,"checkConnection",(function(){return fetch("/token-verify/",{method:"POST",body:JSON.stringify({token:""})}).then((function(e){0!==t.connectionState&&(t.connectionState=0,t.onOnline())})).catch((function(e){1!==t.connectionState&&(t.connectionState=1,t.onOffline())}))})),B()(this,"subscribe",(function(e,n,o){var A=t.commands.SUBSCRIBE,r=t.fmtMessage(A,e),c=JSON.stringify(e);t.initSocket().addSubscriberCallback(n,c).addEventCallback(A,o,c).send(r)})),B()(this,"reSubscribe",(function(){var e=t.commands.SUBSCRIBE;Array.from(t.sub_callbacks.keys()).forEach((function(n){var o=t.fmtMessage(e,JSON.parse(n));t.send(o)}))})),B()(this,"unsubscribe",(function(e,n){var o=t.commands.UNSUBSCRIBE,A=t.fmtMessage(o,e),r=JSON.stringify(e);t.initSocket().addEventCallback(o,n,r).send(A)})),B()(this,"list",(function(e){var n=t.commands.LIST,o=t.fmtMessage(n);t.initSocket().addEventCallback(n,e).send(o)})),B()(this,"execute",(function(e,n,o){var A=t.commands.EXECUTE,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){B()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({event:A,callback:e},n);t.initSocket().addEventCallback(A,o).send(r)})),B()(this,"onEvent",(function(e,n){t.initSocket().addEventCallback(e,n)})),B()(this,"close",(function(){t.websocket.close(),t.websocket=null})),B()(this,"checkTest",(function(e,n,o,A){return new Promise((function(r,c){t.dispatch(e,n,o,A),r("DONE")}))})),B()(this,"getVar",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";if(!["global","fleet"].includes(o))throw"Only fleet and global scopes available.";if("fleet"===o&&e.split("@").length<2)throw"Wrong key format (robot_name@key_name)";var A=t.REST_API+"database/"+o+"/"+e+"/";O().then((function(e){fetch(A).then((function(e){return e.json()})).then((function(e){n&&n(e)})).catch((function(e){console.log(e)}))}))})),B()(this,"setVar",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";if(!["global","fleet"].includes(A))throw"Only fleet and global scopes available.";if("fleet"===A&&(e.split("@"),e.split("@").length<2))throw"Wrong key format (robot_name@key_name)";var r={key:e,scope:A,value:n},c=t.REST_API+"database/";O().then((function(e){if(!e)throw new D("login error");fetch(c,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){o&&o(e)}))}))})),B()(this,"get",function(){var e=o()(r().mark((function e(n){var A,c=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A=c.length>1&&void 0!==c[1]?c[1]:void 0,O().then(function(){var e=o()(r().mark((function e(o){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw new D("login error");case 2:t.fetchTimeout(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){A&&e.json().then((function(t){A(t,e)})).catch((function(e){A(void 0,e)}))})).catch((function(e){return A(void 0,e)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),B()(this,"post",(function(e,n,o,A){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=t.REST_API+e+"/"+n+"/";void 0===n&&(c=t.REST_API+e+"/"),O().then((function(e){if(!e)throw new D("login error");fetch(c,{method:"POST",body:JSON.stringify({key:o,data:A}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){r&&e.json().then((function(t){r(t,e)})).catch((function(e){r(void 0,e)}))}))}))})),B()(this,"upload",(function(e,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r="".concat(t.REST_API,"upload/").concat(e,"/"),c=new FormData;c.append("name",n),c.append("data",o),fetch(r,{method:"POST",body:c,headers:{Authorization:"Bearer ".concat(T())}}).then((function(e){return e.json()})).then(A)})),B()(this,"put",(function(e,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=t.REST_API+e+"/"+n+"/";void 0===n&&(r=t.REST_API+e+"/"),O().then((function(e){if(!e)throw new D("login error");fetch(r,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){A&&e.json().then((function(t){A(t,e)})).catch((function(t){A(void 0,e)}))}))}))})),B()(this,"delete",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.REST_API+e+"/"+n+"/";void 0!==n?O().then((function(e){if(!e)throw new D("login error");fetch(r,{method:"DELETE",body:JSON.stringify(A),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){o&&e.json().then((function(t){o(t,e)})).catch((function(t){o(void 0,e)}))}))})):r=t.REST_API+e+"/"})),B()(this,"cloudFunction",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return O().then((function(r){if(!r)throw new D("login error");var c=t.REST_API+"function/"+e+"/";return fetch(c,{method:"POST",body:JSON.stringify({func:n,args:o}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){A&&e.json().then((function(e){return A(e)})).catch((function(e){console.log("cloudFunction error",e),A({result:!1,error:e})}))}))}))})),B()(this,"postTabs",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A="User",r=t.REST_API+A+"/"+e+"/";if(void 0!==e){var c=n.map((function(e){return{componentName:e.componentName,name:e.name}})),i={Workspace:"*"};O().then((function(e){fetch(r,{method:"POST",body:JSON.stringify({key:i,data:c}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T())}}).then((function(e){o&&e.json().then((function(t){o(t,e)})).catch((function(t){o(void 0,e)}))}))}))}else r=t.REST_API+A+"/"}));var n="https:"===window.location.protocol;this.host="".concat(window.location.hostname,":").concat(window.location.port),this.url="".concat(n?"wss":"ws","://").concat(this.host,"/ws/subscriber"),this.REST_API="".concat(window.location.protocol,"//").concat(this.host,"/api/v1/"),this.RECONN_TIMEOUT=3e3,this.RECONN_VALIDATION_TIMEOUT=5e3,this.RESEND_TIMEOUT=1e3,this.RETRIES=3,this.NORMAL_CLOSE_EVT=1e3,this.commands={SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",LIST:"list",EXECUTE:"execute"},this.onOnline=function(){},this.onOffline=function(){},this.connectionState=0,this.websocket=null,this.sub_callbacks=new Map,this.evt_callbacks=new Map},j=new R,N=require("@babel/runtime/helpers/esm/slicedToArray");var F=e.n(N),Y={encodeURI:function(e){for(var t={},n=0,o=Object.entries(e);n<o.length;n++){var A=F()(o[n],2),r=A[0],c=A[1];t[r]=encodeURIComponent(c)}return t},getUrl:function(e){var t=e.path,n=e.search,o=void 0===n?{}:n,A="".concat(window.location.hostname,":").concat(window.location.port),r=new URLSearchParams(Y.encodeURI(o));return"".concat(window.location.protocol,"//").concat(A,"/api/").concat(t,"?").concat(r.toString())},_request:function(e){var t=e.url,n=e.path,o=e.method,A=void 0===o?"GET":o,r=e.body,c=void 0===r?{}:r,i=e.search,a=e.customHeaders,s=void 0===a?{}:a,u=t||Y.getUrl({path:n,search:i}),h={method:A,headers:s};return["HEAD","GET"].includes(A)||(h.body=JSON.stringify(c)),fetch(u,h).then((function(e){return e.ok?e.json():Promise.reject(e)}))},get:function(e){var t=e.url,n=e.path,o=e.search,A=e.customHeaders,r=void 0===A?{}:A;return Y._request({url:t,path:n,search:o,customHeaders:r})},post:function(e){var t=e.url,n=e.path,o=e.body,A=e.customHeaders,r=void 0===A?{}:A;return Y._request({url:t,path:n,method:"POST",body:o,customHeaders:r})},put:function(e){var t=e.url,n=e.path,o=e.body,A=e.customHeaders,r=void 0===A?{}:A;return Y._request({url:t,path:n,method:"PUT",body:o,customHeaders:r})},delete:function(e){var t=e.url,n=e.path,o=e.body,A=e.customHeaders,r=void 0===A?{}:A;return Y._request({url:t,path:n,method:"DELETE",body:o,customHeaders:r})},upload:function(e){var t=e.packageName,n=e.key,o=e.value,A=e.customHeaders,r=void 0===A?{}:A,c="v1/upload/".concat(t,"/"),i=new FormData;return i.append("name",n),i.append("data",o),Y.post({path:c,body:i,customHeaders:r})},cloudFunction:function(e){var t=e.cbName,n=e.func,o=void 0===n?"":n,A=e.args,r=e.customHeaders,c=void 0===r?{}:r,i="v1/function/".concat(t,"/"),a={func:o,args:A};return Y.post({path:i,body:a,customHeaders:c})},validScope:function(e){return["global","fleet"].includes(e)},validKey:function(e){return e.split("@")>=2},validateVar:function(e,t){[{fn:function(e){return Y.validScope(e)},error:"Invalid scope"},{fn:function(e){return Y.validKey(e)},error:"Key format should be <robot name>@<key name>"}].forEach((function(e){if(!e.fn())throw new Error(e.error)}))},getVar:function(e){var t=e.key,n=e.scope,o=void 0===n?"global":n,A=e.customHeaders,r=void 0===A?{}:A;Y.validateVar(t,o);var c="v1/database/".concat(o,"/").concat(t,"/");return Y.get({path:c,customHeaders:r}).then((function(e){return e.json()}))},setVar:function(e){var t=e.key,n=e.value,o=e.scope,A=void 0===o?"global":o,r=e.customHeaders,c=void 0===r?{}:r;Y.validateVar(t,A);var i={key:t,scope:A,value:n};return Y.post({path:"v1/database/",body:i,customHeaders:c}).then((function(e){return e.json()}))}};const P=Y;function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){B()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=s.checkLogin,H=s.AuthException,J=s.getToken;const G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={__checkLogin:function(e,t){return function(n){return V().then((function(o){if(!o)throw new H("Login error");var A={"Content-Type":"application/json",Authorization:"Bearer ".concat(J())};return Reflect.get(e,t)(_({customHeaders:A},n))}))}},get:function(e,t){return this.__checkLogin(e,t)}};return new Proxy(Object.assign(e,t),n)}(P);var z=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";d()(this,e),this.id=t,this.ip=n,this.name=o,this.logs=[],this.logger={status:0,timeout:null,time:3e3},this.logSubscriptions={},this.onGetIPCallback=function(){}}return I()(e,[{key:"subscribe",value:function(t){var n=t.property,o=t.propValue,A=void 0===o?"*":o,r=t.onLoad,c=void 0===r?function(){}:r,i=t.onUpdate,a=void 0===i?function(){}:i;j.subscribe(B()({Scope:e.SCOPE,Name:this.id},n,A),(function(e){return a(e)}),(function(e){return c(e)}))}},{key:"unsubscribe",value:function(t){var n=t.property,o=t.propValue,A=void 0===o?"*":o;j.unsubscribe(B()({Scope:e.SCOPE,Name:this.id},n,A))}},{key:"getIP",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(""!==this.ip)return this.ip;this.onGetIPCallback=e,this.subscribe("IP",this._loadIP(this))}},{key:"startLogger",value:function(){this.logger.status=1,this._getLogs()}},{key:"stopLogger",value:function(){this.logger.status=2,clearTimeout(this.logger.timeout)}},{key:"subscribeToLogs",value:function(e){var t=p.randomGuid();return this.logSubscriptions[t]={send:e},1!==this.logger.status?this.startLogger():this.logs&&e(this.logs),t}},{key:"unsubscribeToLogs",value:function(e){e&&this.logSubscriptions[e]&&(delete this.logSubscriptions[e],0===Object.keys(this.logSubscriptions).length&&this.stopLogger())}},{key:"refreshLogs",value:function(){clearTimeout(this.logger.timeout),this._getLogs()}},{key:"_getLogs",value:function(){var e=this;if(0!==Object.keys(this.logSubscriptions).length&&1===this.logger.status&&this.ip){var t="http://".concat(this.ip,"/api/v1/logs/?level=info,error,warning,critical&limit=50&tags=ui");G.get({url:t}).then((function(t){if(t&&t.data&&t.data.length){for(var n in e.logs=t.data,e.logSubscriptions)e.logSubscriptions[n].send(t.data);e._enqueueNextRequest()}})).catch((function(t){e.logger.time+=1e3,e._enqueueNextRequest()}))}}},{key:"_enqueueNextRequest",value:function(){var e=this;clearTimeout(this.logger.timeout),this.logger.timeout=setTimeout((function(){return e._getLogs()}),this.logger.time)}},{key:"_loadIP",value:function(e){return function(t){t.value?(e.ip=t.value.Robot[e.id].IP,e.onGetIPCallback(e.ip)):e.ip=null}}}]),e}();B()(z,"SCOPE","Robot");const L=z;var W=function(){function e(){if(d()(this,e),K)return K;this.randomId=p.randomGuid(),this.robots={},this.cachedRobots={},this.subscribeToRedis(),K=this}return I()(e,[{key:"subscribeToRedis",value:function(){var e=this;j.subscribe({Scope:"Robot",RobotName:"*",IP:"*"},(function(){}),(function(t){t.value&&(e.cachedRobots=t.value.Robot)}))}},{key:"getAll",value:function(){return this.cachedRobots}},{key:"getRobot",value:function(e){if(this.robots[e])return this.robots[e];var t,n=this.cachedRobots[e];return t=n?new L(e,n.IP,n.RobotName):new L(e),this.robots[e]=t,t}}]),e}(),K=null;const q=W;var X=s.getToken,Z=s.AuthException,$=s.checkLogin;const ee=function e(){var t=this;d()(this,e),B()(this,"connect",(function(){t.websocket=new S({url:t.WS_API,onOpen:t.onOpen,onClose:t.onClose,onError:t.onError,onMessage:t.onMessage,connectionHandler:null}),t.websocket.createSocket()})),B()(this,"onOpen",(function(e){t.dispatch("onopen",void 0)})),B()(this,"onClose",(function(e){t.dispatch("onclose",void 0),1e3!==e.code&&window.setTimeout(t.connect(),t.timeout)})),B()(this,"onMessage",(function(e){var n;try{n=JSON.parse(e.data)}catch(e){return void console.error(e)}if(n.error)console.error(n.error);else{var o=n.patterns,A=!0,r=!1;["list","unsubscribe","subscribe"].includes(n.event)&&(o=o.map((function(e){return"unsubscribe"===n.event&&delete t.callbacks[JSON.stringify(e)],n.event+"/"+JSON.stringify(e)})),"list"===n.event&&(o=["list"]),A=!1,r=!0),o.map((function(e){t.dispatch(e,n,A,r)}))}})),B()(this,"checkTest",(function(e,n,o,A){return new Promise((function(r,c){t.dispatch(e,n,o,A),r("DONE")}))})),B()(this,"onError",(function(e){t.dispatch("onerror",void 0)})),B()(this,"onEvent",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t.evt_callbacks[e]=t.evt_callbacks[e]||[],t.evt_callbacks[e].push(n)})),B()(this,"close",(function(){return t.websocket.close()})),B()(this,"subscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A={event:"subscribe",pattern:e},r=JSON.stringify(e);t.callbacks[r]=t.callbacks[r]||[],t.callbacks[r].push(n),o&&(t.evt_callbacks["subscribe/"+r]=t.evt_callbacks["subscribe"+r]||[],t.evt_callbacks["subscribe/"+r].push(o)),t._send(A)})),B()(this,"unsubscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;console.log("Unsubscribe called "+JSON.stringify(e));var o={event:"unsubscribe",pattern:e},A=JSON.stringify(e);n&&(t.evt_callbacks["unsubscribe/"+A]=t.evt_callbacks["unsubscribe/"+A]||[],t.evt_callbacks["unsubscribe/"+A].push(n)),t._send(o)})),B()(this,"list",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n={event:"list"};t.evt_callbacks.list=t.evt_callbacks.list||[],t.evt_callbacks.list.push(e),t._send(n)})),B()(this,"_send",(function(e){t.websocket.send(JSON.stringify(e))})),B()(this,"dispatch",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=void 0,c=e;if(!0===o?(c=JSON.stringify(e),r=t.callbacks[c]):r=t.evt_callbacks[c],void 0!==r){for(var i=0;i<r.length;i++)"function"==typeof r[i]&&r[i](n);r&&!0===A&&(r=[])}})),B()(this,"getVar",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";if(!["global","fleet"].includes(o))throw"Only fleet and global scopes available.";if("fleet"===o&&e.split("@").length<2)throw"Wrong key format (robot_name@key_name)";var A=t.REST_API+"database/"+o+"/"+e+"/";$().then((function(e){fetch(A).then((function(e){return e.json()})).then((function(e){n&&n(e)})).catch((function(e){console.log(e)}))}))})),B()(this,"setVar",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";if(!["global","fleet"].includes(A))throw"Only fleet and global scopes available.";if("fleet"===A&&(e.split("@"),e.split("@").length<2))throw"Wrong key format (robot_name@key_name)";var r={key:e,scope:A,value:n},c=t.REST_API+"database/";$().then((function(e){if(!e)throw new Z("login error");fetch(c,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){o&&o(e)})).catch((function(e){console.log(e)}))}))})),B()(this,"get",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;$().then((function(n){if(!n)throw new Z("login error");fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){t&&e.json().then((function(n){t(n,e)})).catch((function(e){t(void 0,e)}))}))}))})),B()(this,"post",(function(e,n,o,A){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=t.REST_API+e+"/"+n+"/";void 0===n&&(c=t.REST_API+e+"/"),$().then((function(e){if(!e)throw new Z("login error");fetch(c,{method:"POST",body:JSON.stringify({key:o,data:A}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){r&&e.json().then((function(t){r(t,e)})).catch((function(e){r(void 0,e)}))}))}))})),B()(this,"upload",(function(e,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r="".concat(t.REST_API,"upload/").concat(e,"/"),c=new FormData;c.append("name",n),c.append("data",o),fetch(r,{method:"POST",body:c}).then((function(e){return e.json()})).then(A).catch((function(e){console.log("upload error",e),A(void 0)}))})),B()(this,"put",(function(e,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=t.REST_API+e+"/"+n+"/";console.log("database put",r),void 0===n&&(r=t.REST_API+e+"/"),$().then((function(e){if(!e)throw new Z("login error");fetch(r,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){A&&e.json().then((function(t){A(t,e)})).catch((function(t){A(void 0,e)}))}))}))})),B()(this,"delete",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.REST_API+e+"/"+n+"/";void 0!==n?$().then((function(e){if(!e)throw new Z("login error");fetch(r,{method:"DELETE",body:JSON.stringify(A),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){o&&e.json().then((function(t){o(t,e)})).catch((function(t){o(void 0,e)}))}))})):r=t.REST_API+e+"/"})),B()(this,"cloudFunction",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;$().then((function(r){if(!r)throw new Z("login error");var c=t.REST_API+"function/"+e+"/";fetch(c,{method:"POST",body:JSON.stringify({func:n,args:o}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){A&&e.json().then((function(e){return A(e)})).catch((function(e){console.log(e),A(void 0)}))}))}))})),B()(this,"postTabs",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A="User",r=t.REST_API+A+"/"+e+"/";if(void 0!==e){var c=n.map((function(e){return{componentName:e.componentName,name:e.name}})),i={Workspace:"*"};$().then((function(e){fetch(r,{method:"POST",body:JSON.stringify({key:i,data:c}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(X())}}).then((function(e){o&&e.json().then((function(t){o(t,e)})).catch((function(t){o(void 0,e)}))}))}))}else r=t.REST_API+A+"/"})),this.host="".concat(window.location.hostname,":").concat(window.location.port);var n="https:"===window.location.protocol;this.WS_API="".concat(n?"wss":"ws","://").concat(this.host,"/ws/subscriber"),this.REST_API="".concat(window.location.protocol,"//").concat(this.host,"/api/v1/"),this.callbacks={},this.evt_callbacks={},this.timeout=3e3,this.websocket=void 0,this.connect()},te="\n@font-face {\n  font-family: 'mov.ai';\n  src: url(".concat("data:font/woff;base64,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",') format("woff");\n  font-weight: normal;\n  font-style: normal;\n  font-display: block;\n}\n\n[class^="icon-"], [class*=" icon-"] {\n  /* use !important to prevent issues with browser extensions that change fonts */\n  font-family: \'mov.ai\' !important;\n  speak: none;\n  font-style: normal;\n  font-weight: normal;\n  font-variant: normal;\n  text-transform: none;\n  line-height: 1;\n\n  /* Better Font Rendering =========== */\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.icon-widget:before {\n  content: "\\e900";\n}\n.icon-tree:before {\n  content: "\\e903";\n}\n.icon-Statistics:before {\n  content: "\\e906";\n}\n.icon-Scenes:before {\n  content: "\\e907";\n}\n.icon-Sad:before {\n  content: "\\e908";\n}\n.icon-repeat:before {\n  content: "\\e909";\n}\n.icon-packages:before {\n  content: "\\e90c";\n}\n.icon-outline-off:before {\n  content: "\\e90d";\n}\n.icon-outline:before {\n  content: "\\e90e";\n}\n.icon-out:before {\n  content: "\\e90f";\n}\n.icon-Nodes:before {\n  content: "\\e911";\n}\n.icon-Layouts:before {\n  content: "\\e913";\n}\n.icon-info:before {\n  content: "\\e914";\n}\n.icon-in:before {\n  content: "\\e915";\n}\n.icon-Happy:before {\n  content: "\\e916";\n}\n.icon-grid:before {\n  content: "\\e917";\n}\n.icon-Filters:before {\n  content: "\\e918";\n}\n.icon-expand_more:before {\n  content: "\\e919";\n}\n.icon-expand_less:before {\n  content: "\\e91a";\n}\n.icon-Empty:before {\n  content: "\\e91b";\n}\n.icon-edit:before {\n  content: "\\e91c";\n}\n.icon-drag_indicator:before {\n  content: "\\e91d";\n}\n.icon-download:before {\n  content: "\\e91e";\n}\n.icon-details:before {\n  content: "\\e91f";\n}\n.icon-delete:before {\n  content: "\\e920";\n}\n.icon-create_new_folder:before {\n  content: "\\e921";\n}\n.icon-chevron_right:before {\n  content: "\\e923";\n}\n.icon-chevron_left:before {\n  content: "\\e924";\n}\n.icon-heck_circle:before {\n  content: "\\e925";\n}\n.icon-carts:before {\n  content: "\\e926";\n}\n.icon-Callbacks:before {\n  content: "\\e928";\n}\n.icon-Annotations:before {\n  content: "\\e929";\n}\n.icon-add:before {\n  content: "\\e92b";\n}\n');var ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;d()(this,e),this.size=t,this.undoStack=new Ae(t),this.redoStack=new Ae(t)}return I()(e,[{key:"doIt",value:function(e){e.doAction(),this.undoStack.push(e),this.redoStack=new Ae(this.size)}},{key:"addIt",value:function(e){this.undoStack.push(e),this.redoStack=new Ae(this.size)}},{key:"undo",value:function(e){var t=this.undoStack.pop();t&&(t.undoAction(e),this.redoStack.push(t))}},{key:"redo",value:function(e){var t=this.redoStack.pop();t&&(t.doAction(e),this.undoStack.push(t))}}],[{key:"actionBuilder",value:function(){return new oe}}]),e}(),oe=function(){function e(){d()(this,e),this._doAction=null,this._undoAction=null}return I()(e,[{key:"doAction",value:function(e){return this._doAction=e,this}},{key:"undoAction",value:function(e){return this._undoAction=e,this}},{key:"build",value:function(){if([this._undoAction,this._undoAction].some((function(e){return null==e})))throw"Forgot to set doAction or undoAction";return{doAction:this._doAction,undoAction:this._undoAction}}}]),e}(),Ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;d()(this,e),this.size=t,this.queue=[]}return I()(e,[{key:"push",value:function(e){this.queue.length===this.size&&this.queue.shift(),this.queue.push(e)}},{key:"pop",value:function(){return this.queue.pop()}}]),e}(),re=function(){function e(){if(d()(this,e),e.instance)return e.instance;e.instance=this,this._data={},this.copyKey=Math.random()}return I()(e,[{key:"data",get:function(){return this._data}}],[{key:"clear",value:function(t){var n=new e;t&&delete n._data[t]}},{key:"read",value:function(t){var n=new e;return t?n.data[t]:n.data}},{key:"write",value:function(t,n){return(new e)._data[t]=n}},{key:"copy",value:function(t){e.write((new e).copyKey,t)}},{key:"paste",value:function(){return e.read((new e).copyKey)}}]),e}();const ce=function e(){var t=this;d()(this,e),B()(this,"getData",(function(){var e={"Content-Type":"application/json",Authorization:"Bearer ".concat(s.getToken())},n=t.tokenData.message.name,o="".concat(t.baseUrl,"/").concat(n,"/");return new Promise((function(n,A){var r=(new Date).getTime();if(r-t.timestamp<=t.TIMEOUT&&t.data)return n({response:t.data});t.timestamp=r,fetch(o,{headers:e}).then((function(e){e.ok||A({error:e.statusText}),e.json().then((function(e){t.data=e,n({response:e})})).catch((function(e){t.data=null,A({error:e})}))})).catch((function(e){t.data=null,A({error:e})}))}))})),B()(this,"isSuperUser",o()(r().mark((function e(){var n,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getData();case 2:return o=e.sent,e.abrupt("return",(null==o||null===(n=o.response)||void 0===n?void 0:n.Superuser)||!1);case 4:case"end":return e.stop()}}),e)})))),this.baseUrl="".concat(window.location.origin,"/api/v1/User"),this.tokenData=s.getTokenData(),this.data=null,this.timestamp=null,this.TIMEOUT=3e3},ie=require("rxjs"),ae=require("lodash");var se=e.n(ae),ue=function(){function e(t,n,o,A){var r=this;d()(this,e),B()(this,"_initialize",(function(){return r.patterns.forEach((function(e){return r._subscribe(e)})),r})),B()(this,"_subscribe",(function(e){r.db.subscribe(e,(function(e){return r._onDataChange(e)}),(function(e){return r._onDataLoad(e)}))})),B()(this,"_validatePatterns",(function(e){var t={Scope:r.model,Name:"*"},n=e||t;return Array.isArray(n)?n:[n]})),B()(this,"get",(function(e){return r._cache.get(e)})),B()(this,"getAll",(function(){return r._cache.values()})),B()(this,"_get_or_create",(function(e){return r.get(e)||r.add(e,{name:e,obj:{},id:e}).get(e)})),B()(this,"add",(function(e,t){return r._cache.set(e,t)})),B()(this,"remove",(function(e){r._cache.delete(e)})),B()(this,"destroy",(function(){r.patterns.forEach((function(e){return r.db.unsubscribe(e)}))})),B()(this,"removeEmpty",(function(e,t){var n=null;if(se().isEmpty(se().get(e,t,{}))){n=se().omit(e,t);var o=t.split(".");o.length>1&&(n=r.removeEmpty(n,o.slice(0,-1).join(".")))}return n||e})),B()(this,"_onDataChange",(function(e){var t=se().get(e,"key.".concat(r.model),{});Object.keys(t).forEach((function(n){var o=r._get_or_create(n);if("del"===e.event){var A=Object.keys(p.flattenObject(t[n]))[0];o.obj=r.removeEmpty(se().omit(o.obj,A),A),se().isEmpty(o.obj)&&r.remove(n)}else se().merge(o.obj,t[n]);r._subject.next({data:o,event:e.event})}))})),B()(this,"_onDataLoad",(function(e){var t=se().get(e,"value.".concat(r.model),{});Object.keys(t).forEach((function(e){var n=r._get_or_create(e);se().merge(n.obj,t[e])})),--r.nr_patterns<=0&&(r.db_state=r.db_states.ready)})),B()(this,"onReady",(function(e){r.db_state!==r.db_states.ready?r._subject_state.subscribe((function(){}),(function(){}),(function(){return e()})):e()})),B()(this,"onUpdate",(function(e){r._subject.subscribe(e)})),this.db_states=Object.freeze({error:-1,loading:0,ready:1}),this.db=o,this.model=n,this.manager=t,this._subject=new ie.Subject,this._cache=new Map,this._subject_state=new ie.BehaviorSubject(0),this._db_state=this.db_states.loading,this.patterns=this._validatePatterns(A),this.nr_patterns=this.patterns.length,this._initialize()}return I()(e,[{key:"db_state",get:function(){return this._db_state},set:function(e){e!==this._db_state&&(this._db_state=e,e!==this.db_states.ready?this._subject_state.next(e):this._subject_state.complete())}}]),e}(),he=function(){function e(){var t=this;d()(this,e),B()(this,"_initialize",(function(){if(se().isEmpty(t.models))throw new Error("No models added");return Object.keys(t.models).forEach((function(e){var n=e.charAt(0).toLowerCase()+e.slice(1);Object.defineProperty(t,n,{get:function(){return t.models[e]}})})),t._subscribeModelsReady()})),B()(this,"_subscribeModelsReady",(function(){return Object.keys(t.models).forEach((function(e){t.models[e].onReady((function(){return t._setModelReady(e)}))})),t})),B()(this,"_setModelReady",(function(e){t.isReady+=1,t.isReady===Object.keys(t.models).length&&t._subject_state.complete()})),B()(this,"onUpdate",(function(e,t){return e.onUpdate(t)})),B()(this,"onReady",(function(e){t.db_state!==t.db_states.ready?t._subject_state.subscribe((function(){}),(function(){}),(function(){return e()})):e()})),this.models={},this.db_states=Object.freeze({error:-1,loading:0,ready:1}),this.isReady=0,this._subject_state=new ie.BehaviorSubject(0)}return I()(e,[{key:"db_state",get:function(){return this.isReady===Object.keys(this.models).length?this.db_states.ready:this.db_states.loading}}]),e}();function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){B()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const de=function(){function e(t){var n=this,o=t.type,A=t.name,r=t.workspace,c=void 0===r?"global":r,i=t.version,a=t.path;d()(this,e),B()(this,"_init",(function(e,t,o,A,r){n._parseArgs(o,e,t,A,r),n.subscriber=void 0,n.database=j,n.data={}})),B()(this,"_parseArgs",(function(e,t,o,A,r){var c=(r||"").split("/"),i=F()(c,4),a=i[0],s=i[1],u=i[2],h=i[3];n.workspace=a||e,n.type=s||t,n.name=u||o,n.version=h||A})),B()(this,"read",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"v1",t=n.type,o=n.name,A="v1"===e?"v1/".concat(t,"/").concat(o,"/"):"v2/db/".concat(n.path);return G.get({path:A}).then((function(A){return n.data=A,"v1"===e?A:A[t][o]}))})),B()(this,"update",(function(e){var t=n.type,o=n.name,A="v1/".concat(t,"/").concat(o,"/");return G.put({path:A,body:e})})),B()(this,"overwrite",(function(e){var t=n.type,o=n.name,A="v1/".concat(t,"/").concat(o,"/");return G.post({path:A,body:{data:ge({},e)}})})),B()(this,"subscribe",(function(e){n.resubscribe(e)})),B()(this,"resubscribe",(function(e){n.readOnly||(n.unsubscribe(),n.subscriber=new ue({},n.type,n.database,[{Scope:n.type,Name:n.name}]),n.subscriber.onUpdate((function(){var t;n.subscriber&&(n.data=(null===(t=n.subscriber.get(n.name))||void 0===t?void 0:t.obj)||{},e(n.data))})))})),B()(this,"unsubscribe",(function(){n.subscriber&&n.subscriber.destroy(),n.subscriber=null})),this._init(o,A,c,i,a)}return I()(e,[{key:"readOnly",get:function(){return"global"!==this.workspace}},{key:"url",get:function(){return this.path}},{key:"path",get:function(){var e=this.workspace,t=this.type,n=this.name,o=this.version;return"".concat(e,"/").concat(t,"/").concat(n,"/").concat(o)}}],[{key:"create",value:function(e){var t=e.type,n=e.name,o=e.body,A=void 0===o?{}:o,r="v1/".concat(t,"/");return G.post({path:r,body:{data:ge(ge({},A),{},{Label:n})}})}},{key:"delete",value:function(e){var t=e.type,n=e.name,o=e.body,A="v1/".concat(t,"/").concat(n,"/");return G.delete({path:A,body:o})}}]),e}(),fe=require("@babel/runtime/helpers/esm/assertThisInitialized");var Be=e.n(fe);const Ee=require("@babel/runtime/helpers/esm/inherits");var ve=e.n(Ee);const we=require("@babel/runtime/helpers/esm/possibleConstructorReturn");var be=e.n(we);const pe=require("@babel/runtime/helpers/esm/getPrototypeOf");var ye=e.n(pe);var me=function(e){ve()(A,e);var t,n,o=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=ye()(t);if(n){var A=ye()(this).constructor;e=Reflect.construct(o,arguments,A)}else e=o.apply(this,arguments);return be()(this,e)});function A(){var e;d()(this,A);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),B()(Be()(e),"read",(function(){var t=Be()(e),n=t.workspace,o=t.type,A=t.name,r=t.version,c="v2/db/".concat(n,"/").concat(o,"/").concat(A,"/").concat(r);return G.get({path:c}).then((function(t){return e.data=t,t}))})),B()(Be()(e),"update",(function(t){var n=Be()(e),o=n.workspace,A=n.type,r=n.name,c=n.version,i="v2/db/".concat(o,"/").concat(A,"/").concat(r,"/").concat(c);return G.put({path:i,body:t})})),B()(Be()(e),"createSnapshot",(function(t){var n=t.trgWorkspace,o=t.version,A=Be()(e),r=A.workspace,c=A.type,i=A.name;return Snapshot.create({trgWorkspace:n,srcWorkspace:r,type:c,name:i,version:o})})),B()(Be()(e),"getSnapShots",(function(){var t=Be()(e),n=t.workspace,o=t.type,A=t.name;return Snapshot.getAll({workspace:n,type:o,name:A})})),e}return I()(A,null,[{key:"create",value:function(e){var t=e.type,n=e.name,o=e.workspace,A="v2/db/".concat(o,"/").concat(t,"/").concat(n),r={Label:n};return G.post({path:A,body:r})}},{key:"delete",value:function(e){var t=e.type,n=e.name,o=e.body,A=e.workspace,r="v2/db/".concat(void 0===A?"global":A,"/").concat(t,"/").concat(n);return G.delete({path:r,body:o})}}]),A}(de);B()(me,"getDocs",(function(e){var t=e.workspace,n=e.scope,o=e.id,A=n?"/".concat(n):"",r=n&&o?"/".concat(o):"",c="v2/db/".concat(t).concat(A).concat(r);return G.get({path:c})}));const Ie=me;var Me=function(e){return{v1:de,v2:Ie}[e]};const Qe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return d()(this,e),new(Me(n))(t)}return I()(e,null,[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return Me(t).create(e)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return Me(t).delete(e)}},{key:"parsePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Node",n=e.split("/"),o=n.length>1?n[0]:"global",A=n[1]||t,r=n[2]||e,c=n[3]||"__UNVERSIONED__",i="".concat(o,"/").concat(A,"/").concat(r,"/").concat(c);return{workspace:o,type:A,name:r,version:c,path:i}}},{key:"exists",value:function(e){var t=e.name,n=e.scope,o=e.version,A=e.workspace,r="v2/db/".concat(void 0===A?"global":A,"/").concat(n,"/").concat(t,"/").concat(o);return G.get({path:r}).then((function(e){return!!e[n]})).catch((function(e){return 500!==e.status}))}}]),e}();const ke={create:function(){throw new Error("Not implemented")},delete:function(){throw new Error("Not implemented")},getAll:function(){return G.get({path:"v2/db"})},getDocs:function(e){var t=e.workspace,n=e.scope,o=e.id,A=n?"/".concat(n):"",r=n&&o?"/".concat(o):"",c="v2/db/".concat(t).concat(A).concat(r);return G.get({path:c})}};var Se={_create:function(e){var t=e.target,n=e.body,o=void 0===n?{}:n,A=t.workspace,r=t.type,c=t.name,i=t.version,a="v2/db/".concat(A,"/").concat(r,"/").concat(c,"/").concat(i);return G.post({path:a,body:o})},create:function(e){var t=e.target,n=e.body,o=void 0===n?{}:n;Se._create({target:t,body:{data:o}})},createByRef:function(e){var t=e.target,n=e.source,o={src:"".concat(n.workspace,"/").concat(n.type,"/").concat(n.name,"/").concat(n.version)};return Se._create({target:t,source:n,body:o})},delete:function(){throw new Error("Not implemented")},read:function(e){var t=e.workspace,n=e.type,o=e.name,A=e.version,r="v2/db/".concat(t,"/").concat(n,"/").concat(o,"/").concat(A);return G.get({path:r})},restore:function(e){var t=e.target,n=e.source;return t.workspace="global",Se.createByRef({target:t,source:n})},getAll:function(e){var t=e.workspace,n=e.type,o=e.name,A="v2/db/".concat(t,"/").concat(n,"/").concat(o);return G.get({path:A})}};const Ce=Se;return t})()}));
//# sourceMappingURL=index.js.map