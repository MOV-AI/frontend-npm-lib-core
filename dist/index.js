!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Movai=e():t.Movai=e()}(window,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var A=e[o]={i:o,l:!1,exports:{}};return t[o].call(A.exports,A,A.exports,n),A.l=!0,A.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var A in t)n.d(o,A,function(e){return t[e]}.bind(null,A));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=17)}([function(t,e){t.exports=require("@babel/runtime/helpers/esm/defineProperty")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/classCallCheck")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/createClass")},function(t,e){t.exports=require("@babel/runtime/regenerator")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/assertThisInitialized")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/asyncToGenerator")},function(t,e){t.exports=require("rxjs")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/slicedToArray")},function(t,e){t.exports=require("jwt-decode")},function(t,e){t.exports=require("monet")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/getPrototypeOf")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/typeof")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/inherits")},function(t,e){t.exports=require("@babel/runtime/helpers/esm/possibleConstructorReturn")},function(t,e){t.exports=require("lodash/get")},function(t,e,n){"use strict";n.r(e),n.d(e,"Authentication",(function(){return u})),n.d(e,"Utils",(function(){return M})),n.d(e,"Database",(function(){return Dt})),n.d(e,"MasterDB",(function(){return J})),n.d(e,"AuthWebSocket",(function(){return O})),n.d(e,"Style",(function(){return Ot})),n.d(e,"UndoManager",(function(){return Rt})),n.d(e,"Clipboard",(function(){return Nt})),n.d(e,"WSSub",(function(){return H})),n.d(e,"User",(function(){return Ft})),n.d(e,"BaseModel",(function(){return At})),n.d(e,"DataManagerBase",(function(){return xt})),n.d(e,"BroadcastChannel",(function(){return Q})),n.d(e,"BROADCAST_EVENTS",(function(){return h})),n.d(e,"Document",(function(){return wt})),n.d(e,"RobotManager",(function(){return kt})),n.d(e,"Workspace",(function(){return Pt})),n.d(e,"Snapshot",(function(){return Vt})),n.d(e,"Rest",(function(){return tt}));var o=n(6),A=n.n(o),r=n(3),c=n.n(r),i=n(9),a=n.n(i),s={AuthException:function(t){this.message=t,this.statusText=t,this.name="AuthException"},getToken:function(){var t=window.localStorage.getItem("movai.token");return t||!1},getRefreshToken:function(){var t=window.localStorage.getItem("movai.refreshToken");return t||!1},getTokenData:function(){try{var t=s.getToken();return{message:a()(t).message,auth_token:!1,refresh_token:s.getRefreshToken(),error:!1,access_token:t}}catch(t){return{message:{},error:!0}}}};s.login=function(){var t=A()(c.a.mark((function t(e,n,o){var A,r,i,a,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session"),(A={})["Content-Type"]="application/json","/token-auth/",t.prev=7,t.next=10,fetch("/token-auth/",{method:"POST",headers:A,body:JSON.stringify({username:e,password:n,remember:o})});case 10:if(r=t.sent,i=r.status,a=r.headers.get("content-type"),!(a&&a.includes("application/json"))){t.next=20;break}return t.next=17,r.json();case 17:t.t0=t.sent,t.next=21;break;case 20:t.t0={error:r.statusText};case 21:return s=t.t0,200===i&&(window.localStorage.setItem("movai.token",s.access_token),window.localStorage.setItem("movai.refreshToken",s.refresh_token),window.localStorage.setItem("movai.tokenRemember","undefined"!=o&&o),window.sessionStorage.setItem("movai.session",!0)),t.abrupt("return",s);case 26:return t.prev=26,t.t1=t.catch(7),t.abrupt("return",{error:t.t1.toString()});case 29:case"end":return t.stop()}}),t,null,[[7,26]])})));return function(e,n,o){return t.apply(this,arguments)}}(),s.logout=function(t){window.localStorage.removeItem("movai.token"),window.localStorage.removeItem("movai.refreshToken"),window.localStorage.removeItem("movai.tokenRemember"),window.sessionStorage.removeItem("movai.session"),window.location.replace(t||window.location.origin)},s.checkLogin=A()(c.a.mark((function t(){var e,n,o,A,r,i,u,h,l,f;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.localStorage.getItem("movai.token"),n=window.localStorage.getItem("movai.refreshToken"),o=window.localStorage.getItem("movai.tokenRemember"),A=window.sessionStorage.getItem("movai.session"),null!==e&&null!==n){t.next=6;break}return t.abrupt("return",!1);case 6:r=null,t.prev=7,r=a()(e),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(7),t.abrupt("return",!1);case 14:if(!(r.exp>(new Date).getTime()/1e3)){t.next=16;break}return t.abrupt("return",!0);case 16:if("false"!=o||null!==A){t.next=19;break}return s.logout(),t.abrupt("return",!1);case 19:if(!n){t.next=48;break}if(t.prev=20,!(a()(n).exp<(new Date).getTime()/1e3)){t.next=24;break}throw"refresh token has expired";case 24:return"/token-refresh/",i={"Content-Type":"application/json"},t.next=28,fetch("/token-refresh/",{method:"POST",headers:i,body:JSON.stringify({token:n})});case 28:if(u=t.sent,h=u.status,l=u.headers.get("content-type"),!(l&&l.includes("application/json"))){t.next=38;break}return t.next=35,u.json();case 35:t.t1=t.sent,t.next=39;break;case 38:t.t1=null;case 39:if(f=t.t1,200!==h||!f){t.next=44;break}return window.localStorage.setItem("movai.token",f.access_token),window.localStorage.setItem("movai.refreshToken",f.refresh_token),t.abrupt("return",!0);case 44:t.next=48;break;case 46:t.prev=46,t.t2=t.catch(20);case 48:return t.abrupt("return",!1);case 49:case"end":return t.stop()}}),t,null,[[7,11],[20,46]])})));var u=s,h={ISOPEN:"ISOPEN",RPL_ISOPEN:"RPL-ISOPEN",OPENDOC:"OPENDOC",RPL_OPENDOC:"RPL-OPENDOC"},l=0,f=1,d=2,g=n(12),B=n.n(g),E=n(1),v=n.n(E),b=n(0),w=n.n(b),p=n(13),y=n.n(p),m=n(10),I={ofNull:function(t){return m.Maybe.fromNull(t)},getter:function(t){return function(e){return e[t]}},dot:function(t){return function(e){return function(n){return t(e(n))}}},maybeGet:function(t){return I.dot(I.ofNull)(I.getter(t))},range:function(t,e){for(var n=m.Maybe.fromNull(e).map((function(n){return{i:t,e:e}})).orSome({i:0,e:t}),o=n.i,A=n.e,r=[],c=o;c<A;c++)r.push(c);return r},randomInt:function(t,e){return Math.floor(I.random(t,e))},random:function(t,e){var n=m.Maybe.fromNull(e).map((function(n){return{init:t,end:e}})).orSome({init:0,end:t}),o=n.init;return o+(n.end-o)*Math.random()},normalizeStr:function(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},groupBy:function(t,e){var n={};return t.forEach((function(t){var o=e(t);n[o]||(n[o]=[]),n[o].push(t)})),n},capitalize:function(t){return"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1)},mod:function(t,e){return(t%e+e)%e},flattenObject:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(t).reduce((function(n,o){var A=e.length?e+".":"";return"object"===y()(t[o])?Object.assign(n,I.flattenObject(t[o],A+o)):n[A+o]=t[o],n}),{})},randomGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}},M=I,Q=function t(e){var n=this;v()(this,t),w()(this,"subscribe",(function(t,e){var o=n.subscribed_events[t]||[];n.subscribed_events[t]=[].concat(B()(o),[e]),console.log("BroadcastChannel subscribe to",t)})),w()(this,"unsubscribe",(function(t){n.subscribed_events.hasOwnProperty(t)&&(delete n.subscribed_events[t],console.log("BroadcastChannel unsubscribe to",t))})),w()(this,"postMessage",(function(t){var e=t.event,o=t.target,A=t.data;console.log("BroadcastChannel postMessage to",o),n.instance.postMessage({msgId:M.randomGuid(),event:e,source:n.appName,target:o,data:A||{}})})),w()(this,"close",(function(){n.instance.close(),console.log("BroadcastChannel close for",n.appName)})),w()(this,"_onMessage",(function(t){var e=t.data;n.subscribed_events.hasOwnProperty(e.event)&&e.target===n.appName&&(n.subscribed_events[e.event].forEach((function(t){t(e)})),console.log("BroadcastChannel _onMessage from",e.source))})),this.appName=e,this.subscribed_events={},this.instance=new window.BroadcastChannel("channel"),this.instance.onmessage=this._onMessage,console.log("BroadcastChannel start for",this.appName)},k=n(2),C=n.n(k),S=u.checkLogin,T=u.getToken,D=u.AuthException,O=function(){function t(e){var n=this,o=e.url,A=void 0===o?this.wsUrl:o,r=e.onOpen,c=void 0===r?null:r,i=e.onClose,a=void 0===i?null:i,s=e.onError,u=void 0===s?null:s,h=e.onMessage,l=void 0===h?null:h,f=e.connectionHandler,d=void 0===f?null:f;v()(this,t),w()(this,"_onOpen",(function(t){console.log("Socket Open: ",t)})),w()(this,"_onClose",(function(t){console.log("Socket Close: ",t),n.connected=!1,n.socket=null,n.timerId&&clearTimeout(n.timerId),n.timerId=setTimeout((function(){n.createSocket()}),5e3)})),w()(this,"_onError",(function(t){n.connected=!1,console.log("Socket Error: ",t)})),w()(this,"_onMessage",(function(t){console.log("Socket Message: ",t)})),w()(this,"_connectionHandler",(function(t){console.log("Invalid Token, no handler specified! ",t)})),this.onOpen=null===c?this._onOpen:c,this.onClose=null===a?this._onClose:a,this.onError=null===u?this._onError:u,this.onMessage=null===l?this._onMessage:l,this.connectionHandler=null===d?this._connectionHandler:d,this.wsUrl=A,this.socket=!1,this.timerId=!1,this.connected=!1}return C()(t,[{key:"createSocket",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!1;S().then((function(o){if(!o)throw new D("login error");e=!1!==e?e:t.wsUrl;var A=new URL(e),r=new URLSearchParams(A.search.slice(1));r.set("token",T()),A.search=r,(n=new WebSocket(A.toString())).onopen=t.onOpen,n.onerror=t.onError,n.onclose=t.onClose,n.onmessage=t.onMessage,t.socket=n})).catch((function(e){"AuthException"===e.name&&t.connectionHandler(!1)}))}},{key:"send",value:function(t){var e=this;S().then((function(n){if(!n)throw new D("login error");e.socket.send(t)})).catch((function(n){switch(n.name){case"AuthException":e.connectionHandler(!1);break;case"InvalidStateError":var o=e,A=void 0;A=setInterval((function(){1===o.socket.readyState&&(clearInterval(A),o.socket.send(t))}),400,A)}}))}},{key:"close",value:function(){this.socket&&(this.socket.close(),clearTimeout(this.timerId),this.connected=!1)}}]),t}();function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var U=u.getToken,j=u.AuthException,N=u.checkLogin,F=1,x=2,Y=3,P=4,_=0,V=1,H=function t(){var e=this;v()(this,t),w()(this,"fetchTimeout",(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return Promise.race([fetch(t,e),new Promise((function(t,e){return setTimeout((function(){e(new Error("Timeout"))}),n)}))])})),w()(this,"getState",(function(){var t,n;return(null===(t=e.websocket)||void 0===t||null===(n=t.socket)||void 0===n?void 0:n.readyState)||WebSocket.CLOSED})),w()(this,"initSocket",(function(){if(e.websocket)return e;e.status=F;var t=e.url,n=e.onOpen,o=e.onClose,A=e.onError,r=e.onMessage,c=e.onAuthError;return e.websocket=new O({url:t,onOpen:n,onClose:o,onError:A,onMessage:r,connectionHandler:c}),e.connect(),e})),w()(this,"connect",(function(){return e.status=x,e.websocket.createSocket(),e})),w()(this,"reConnect",(function(){var t=x;[t,Y].includes(e.status)||(e.status=t,setTimeout(e.connect,e.RECONN_TIMEOUT))})),w()(this,"getOrCreate",(function(t,e){return t.get(e)||t.set(e,[]).get(e)})),w()(this,"pushCallback",(function(t,n,o){return e.getOrCreate(t,n).push(o),e})),w()(this,"addSubscriberCallback",(function(t,n){return"function"!=typeof t?e:e.pushCallback(e.sub_callbacks,n,t)})),w()(this,"addEventCallback",(function(t,n,o){if("function"!=typeof n)return e;var A=o?"/".concat(o):"",r="".concat(t).concat(A);return e.pushCallback(e.evt_callbacks,r,n)})),w()(this,"send",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{if(n>=e.RETRIES)throw new Error("Timeout sending message");e.getState()!==WebSocket.OPEN?setTimeout(e.send,e.RESEND_TIMEOUT,t,n+1):e.websocket.send(JSON.stringify(t))}catch(t){console.error(t)}})),w()(this,"dispatch",(function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0,A=n?e.evt_callbacks:e.sub_callbacks,r=A.get(t)||[];r.forEach((function(t){setTimeout(t,0,o)})),n&&A.delete(t)})),w()(this,"fmtMessage",(function(t,e){return{event:t,pattern:e}})),w()(this,"onOpen",(function(t){e.status=Y,e.reSubscribe(),e.dispatch("onopen")})),w()(this,"onClose",(function(t){e.dispatch("onclose"),e.status=P,t.code!==e.NORMAL_CLOSE_EVT&&e.reConnect()})),w()(this,"onError",(function(t){e.dispatch("onerror")})),w()(this,"onAuthError",(function(){e.reConnect()})),w()(this,"onMessage",(function(t){try{var n=JSON.parse(t.data);if(n.error)throw new Error(n.error);var o=n.event,A=Object.values(e.commands).includes(o),r=e.commands;([r.LIST,r.EXECUTE].includes(o)?[o]:n.patterns).forEach((function(t){var r=A?"".concat(o,"/"):"",c="".concat(r).concat(JSON.stringify(t));e.dispatch(c,A,n)}))}catch(t){console.error(t)}})),w()(this,"offlineValidation",(function(t){var n=t.onOnline,o=void 0===n?e.onOnline:n,A=t.onOffline,r=void 0===A?e.onOffline:A;return e.onOnline=o,e.onOffline=r,clearInterval(e.connectionCheckTimeout),e.connectionCheckTimeout=setInterval(e.checkConnection,e.RECONN_VALIDATION_TIMEOUT),e})),w()(this,"retryConnection",(function(){var t=e.checkConnection();return clearInterval(e.connectionCheckTimeout),e.connectionCheckTimeout=setInterval(e.checkConnection,e.RECONN_VALIDATION_TIMEOUT),t})),w()(this,"checkConnection",(function(){return fetch("/token-verify/",{method:"POST",body:JSON.stringify({token:""})}).then((function(t){e.connectionState!==_&&(e.connectionState=_,e.onOnline())})).catch((function(t){e.connectionState!==V&&(e.connectionState=V,e.onOffline())}))})),w()(this,"subscribe",(function(t,n,o){var A=e.commands.SUBSCRIBE,r=e.fmtMessage(A,t),c=JSON.stringify(t);e.initSocket().addSubscriberCallback(n,c).addEventCallback(A,o,c).send(r)})),w()(this,"reSubscribe",(function(){var t=e.commands.SUBSCRIBE;Array.from(e.sub_callbacks.keys()).forEach((function(n){var o=e.fmtMessage(t,JSON.parse(n));e.send(o)}))})),w()(this,"unsubscribe",(function(t,n){var o=e.commands.UNSUBSCRIBE,A=e.fmtMessage(o,t),r=JSON.stringify(t);e.initSocket().addEventCallback(o,n,r).send(A)})),w()(this,"list",(function(t){var n=e.commands.LIST,o=e.fmtMessage(n);e.initSocket().addEventCallback(n,t).send(o)})),w()(this,"execute",(function(t,n,o){var A=e.commands.EXECUTE,r=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){w()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({event:A,callback:t},n);e.initSocket().addEventCallback(A,o).send(r)})),w()(this,"onEvent",(function(t,n){e.initSocket().addEventCallback(t,n)})),w()(this,"close",(function(){e.websocket.close(),e.websocket=null})),w()(this,"checkTest",(function(t,n,o,A){return new Promise((function(r,c){e.dispatch(t,n,o,A),r("DONE")}))})),w()(this,"getVar",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";if(!["global","fleet"].includes(o))throw"Only fleet and global scopes available.";if("fleet"===o&&t.split("@").length<2)throw"Wrong key format (robot_name@key_name)";var A=e.REST_API+"database/"+o+"/"+t+"/";N().then((function(t){fetch(A).then((function(t){return t.json()})).then((function(t){n&&n(t)})).catch((function(t){console.log(t)}))}))})),w()(this,"setVar",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";if(!["global","fleet"].includes(A))throw"Only fleet and global scopes available.";if("fleet"===A){t.split("@");if(t.split("@").length<2)throw"Wrong key format (robot_name@key_name)"}var r={key:t,scope:A,value:n},c=e.REST_API+"database/";N().then((function(t){if(!t)throw new j("login error");fetch(c,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){o&&o(t)}))}))})),w()(this,"get",function(){var t=A()(c.a.mark((function t(n){var o,r=arguments;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=r.length>1&&void 0!==r[1]?r[1]:void 0,N().then(function(){var t=A()(c.a.mark((function t(A){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(A){t.next=2;break}throw new j("login error");case 2:e.fetchTimeout(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){o&&t.json().then((function(e){o(e,t)})).catch((function(t){o(void 0,t)}))})).catch((function(t){return o(void 0,t)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),w()(this,"post",(function(t,n,o,A){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=e.REST_API+t+"/"+n+"/";void 0===n&&(c=e.REST_API+t+"/"),N().then((function(t){if(!t)throw new j("login error");fetch(c,{method:"POST",body:JSON.stringify({key:o,data:A}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){r&&t.json().then((function(e){r(e,t)})).catch((function(t){r(void 0,t)}))}))}))})),w()(this,"upload",(function(t,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r="".concat(e.REST_API,"upload/").concat(t,"/"),c=new FormData;c.append("name",n),c.append("data",o),fetch(r,{method:"POST",body:c,headers:{Authorization:"Bearer ".concat(U())}}).then((function(t){return t.json()})).then(A)})),w()(this,"put",(function(t,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=e.REST_API+t+"/"+n+"/";void 0===n&&(r=e.REST_API+t+"/"),N().then((function(t){if(!t)throw new j("login error");fetch(r,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){A&&t.json().then((function(e){A(e,t)})).catch((function(e){A(void 0,t)}))}))}))})),w()(this,"delete",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=e.REST_API+t+"/"+n+"/";void 0!==n?N().then((function(t){if(!t)throw new j("login error");fetch(r,{method:"DELETE",body:JSON.stringify(A),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){o&&t.json().then((function(e){o(e,t)})).catch((function(e){o(void 0,t)}))}))})):r=e.REST_API+t+"/"})),w()(this,"cloudFunction",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return N().then((function(r){if(!r)throw new j("login error");var c=e.REST_API+"function/"+t+"/";return fetch(c,{method:"POST",body:JSON.stringify({func:n,args:o}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){A&&t.json().then((function(t){return A(t)})).catch((function(t){console.log("cloudFunction error",t),A({result:!1,error:t})}))}))}))})),w()(this,"postTabs",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A="User",r=e.REST_API+A+"/"+t+"/";if(void 0!==t){var c=n.map((function(t){return{componentName:t.componentName,name:t.name}})),i={Workspace:"*"};N().then((function(t){fetch(r,{method:"POST",body:JSON.stringify({key:i,data:c}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(U())}}).then((function(t){o&&t.json().then((function(e){o(e,t)})).catch((function(e){o(void 0,t)}))}))}))}else r=e.REST_API+A+"/"}));var n="https:"===window.location.protocol;this.host="".concat(window.location.hostname,":").concat(window.location.port),this.url="".concat(n?"wss":"ws","://").concat(this.host,"/ws/subscriber"),this.REST_API="".concat(window.location.protocol,"//").concat(this.host,"/api/v1/"),this.RECONN_TIMEOUT=3e3,this.RECONN_VALIDATION_TIMEOUT=5e3,this.RESEND_TIMEOUT=1e3,this.RETRIES=3,this.NORMAL_CLOSE_EVT=1e3,this.commands={SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",LIST:"list",EXECUTE:"execute"},this.onOnline=function(){},this.onOffline=function(){},this.connectionState=_,this.websocket=null,this.sub_callbacks=new Map,this.evt_callbacks=new Map},J=new H,G=n(8),z=n.n(G),L={encodeURI:function(t){for(var e={},n=0,o=Object.entries(t);n<o.length;n++){var A=z()(o[n],2),r=A[0],c=A[1];e[r]=encodeURIComponent(c)}return e},getUrl:function(t){var e=t.path,n=t.search,o=void 0===n?{}:n,A="".concat(window.location.hostname,":").concat(window.location.port),r=new URLSearchParams(L.encodeURI(o));return"".concat(window.location.protocol,"//").concat(A,"/api/").concat(e,"?").concat(r.toString())},_request:function(t){var e=t.url,n=t.path,o=t.method,A=void 0===o?"GET":o,r=t.body,c=void 0===r?{}:r,i=t.search,a=t.customHeaders,s=void 0===a?{}:a,u=e||L.getUrl({path:n,search:i}),h={method:A,headers:s};return["HEAD","GET"].includes(A)||(h.body=JSON.stringify(c)),fetch(u,h).then((function(t){return t.ok?t.json():Promise.reject(t)}))},get:function(t){var e=t.url,n=t.path,o=t.search,A=t.customHeaders,r=void 0===A?{}:A;return L._request({url:e,path:n,search:o,customHeaders:r})},post:function(t){var e=t.url,n=t.path,o=t.body,A=t.customHeaders,r=void 0===A?{}:A;return L._request({url:e,path:n,method:"POST",body:o,customHeaders:r})},put:function(t){var e=t.url,n=t.path,o=t.body,A=t.customHeaders,r=void 0===A?{}:A;return L._request({url:e,path:n,method:"PUT",body:o,customHeaders:r})},delete:function(t){var e=t.url,n=t.path,o=t.body,A=t.customHeaders,r=void 0===A?{}:A;return L._request({url:e,path:n,method:"DELETE",body:o,customHeaders:r})},upload:function(t){var e=t.packageName,n=t.key,o=t.value,A=t.customHeaders,r=void 0===A?{}:A,c="v1/upload/".concat(e,"/"),i=new FormData;return i.append("name",n),i.append("data",o),L.post({path:c,body:i,customHeaders:r})},cloudFunction:function(t){var e=t.cbName,n=t.func,o=void 0===n?"":n,A=t.args,r=t.customHeaders,c=void 0===r?{}:r,i="v1/function/".concat(e,"/"),a={func:o,args:A};return L.post({path:i,body:a,customHeaders:c})},validScope:function(t){return["global","fleet"].includes(t)},validKey:function(t){return t.split("@")>=2},validateVar:function(t,e){[{fn:function(t){return L.validScope(t)},error:"Invalid scope"},{fn:function(t){return L.validKey(t)},error:"Key format should be <robot name>@<key name>"}].forEach((function(t){if(!t.fn())throw new Error(t.error)}))},getVar:function(t){var e=t.key,n=t.scope,o=void 0===n?"global":n,A=t.customHeaders,r=void 0===A?{}:A;L.validateVar(e,o);var c="v1/database/".concat(o,"/").concat(e,"/");return L.get({path:c,customHeaders:r}).then((function(t){return t.json()}))},setVar:function(t){var e=t.key,n=t.value,o=t.scope,A=void 0===o?"global":o,r=t.customHeaders,c=void 0===r?{}:r;L.validateVar(e,A);var i={key:e,scope:A,value:n};return L.post({path:"v1/database/",body:i,customHeaders:c}).then((function(t){return t.json()}))}},W=L;function K(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K(Object(n),!0).forEach((function(e){w()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X=u.checkLogin,Z=u.AuthException,$=u.getToken,tt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={__checkLogin:function(t,e){return function(n){return X().then((function(o){if(!o)throw new Z("Login error");var A={"Content-Type":"application/json",Authorization:"Bearer ".concat($())};return Reflect.get(t,e)(q({customHeaders:A},n))}))}},get:function(t,e){return this.__checkLogin(t,e)}};return new Proxy(Object.assign(t,e),n)}(W),et=n(7),nt=n(4),ot=n.n(nt),At=function(){function t(e,n,o,A){var r=this;v()(this,t),w()(this,"_initialize",(function(){return r.patterns.forEach((function(t){return r._subscribe(t)})),r})),w()(this,"_subscribe",(function(t){r.db.subscribe(t,(function(t){return r._onDataChange(t)}),(function(t){return r._onDataLoad(t)}))})),w()(this,"_validatePatterns",(function(t){var e={Scope:r.model,Name:"*"},n=t||e;return Array.isArray(n)?n:[n]})),w()(this,"get",(function(t){return r._cache.get(t)})),w()(this,"getAll",(function(){return r._cache.values()})),w()(this,"_get_or_create",(function(t){return r.get(t)||r.add(t,{name:t,obj:{},id:t}).get(t)})),w()(this,"add",(function(t,e){return r._cache.set(t,e)})),w()(this,"remove",(function(t){r._cache.delete(t)})),w()(this,"destroy",(function(){r.patterns.forEach((function(t){return r.db.unsubscribe(t)}))})),w()(this,"removeEmpty",(function(t,e){var n=null;if(ot.a.isEmpty(ot.a.get(t,e,{}))){n=ot.a.omit(t,e);var o=e.split(".");o.length>1&&(n=r.removeEmpty(n,o.slice(0,-1).join(".")))}return n||t})),w()(this,"_onDataChange",(function(t){var e=ot.a.get(t,"key.".concat(r.model),{});Object.keys(e).forEach((function(n){var o=r._get_or_create(n);if("del"===t.event){var A=Object.keys(M.flattenObject(e[n]))[0];o.obj=r.removeEmpty(ot.a.omit(o.obj,A),A),ot.a.isEmpty(o.obj)&&r.remove(n)}else ot.a.merge(o.obj,e[n]);r._subject.next({data:o,event:t.event})}))})),w()(this,"_onDataLoad",(function(t){var e=ot.a.get(t,"value.".concat(r.model),{});Object.keys(e).forEach((function(t){var n=r._get_or_create(t);ot.a.merge(n.obj,e[t])})),--r.nr_patterns<=0&&(r.db_state=r.db_states.ready)})),w()(this,"onReady",(function(t){r.db_state!==r.db_states.ready?r._subject_state.subscribe((function(){}),(function(){}),(function(){return t()})):t()})),w()(this,"onUpdate",(function(t){r._subject.subscribe(t)})),this.db_states=Object.freeze({error:-1,loading:0,ready:1}),this.db=o,this.model=n,this.manager=e,this._subject=new et.Subject,this._cache=new Map,this._subject_state=new et.BehaviorSubject(0),this._db_state=this.db_states.loading,this.patterns=this._validatePatterns(A),this.nr_patterns=this.patterns.length,this._initialize()}return C()(t,[{key:"db_state",get:function(){return this._db_state},set:function(t){t!==this._db_state&&(this._db_state=t,t!==this.db_states.ready?this._subject_state.next(t):this._subject_state.complete())}}]),t}();function rt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(n),!0).forEach((function(e){w()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var it=function(){function t(e){var n=this,o=e.type,A=e.name,r=e.workspace,c=void 0===r?"global":r,i=e.version,a=e.path;v()(this,t),w()(this,"_init",(function(t,e,o,A,r){n._parseArgs(o,t,e,A,r),n.subscriber=void 0,n.database=J,n.data={}})),w()(this,"_parseArgs",(function(t,e,o,A,r){var c=(r||"").split("/"),i=z()(c,4),a=i[0],s=i[1],u=i[2],h=i[3];n.workspace=a||t,n.type=s||e,n.name=u||o,n.version=h||A})),w()(this,"read",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"v1",e=n.type,o=n.name,A="v1"===t?"v1/".concat(e,"/").concat(o,"/"):"v2/db/".concat(n.path);return tt.get({path:A}).then((function(A){return n.data=A,"v1"===t?A:A[e][o]}))})),w()(this,"update",(function(t){var e=n.type,o=n.name,A="v1/".concat(e,"/").concat(o,"/");return tt.put({path:A,body:t})})),w()(this,"overwrite",(function(t){var e=n.type,o=n.name,A="v1/".concat(e,"/").concat(o,"/");return tt.post({path:A,body:{data:ct({},t)}})})),w()(this,"subscribe",(function(t){n.resubscribe(t)})),w()(this,"resubscribe",(function(t){n.readOnly||(n.unsubscribe(),n.subscriber=new At({},n.type,n.database,[{Scope:n.type,Name:n.name}]),n.subscriber.onUpdate((function(){var e;n.subscriber&&(n.data=(null===(e=n.subscriber.get(n.name))||void 0===e?void 0:e.obj)||{},t(n.data))})))})),w()(this,"unsubscribe",(function(){n.subscriber&&n.subscriber.destroy(),n.subscriber=null})),this._init(o,A,c,i,a)}return C()(t,[{key:"readOnly",get:function(){return"global"!==this.workspace}},{key:"url",get:function(){return this.path}},{key:"path",get:function(){var t=this.workspace,e=this.type,n=this.name,o=this.version;return"".concat(t,"/").concat(e,"/").concat(n,"/").concat(o)}}],[{key:"create",value:function(t){var e=t.type,n=t.name,o=t.body,A=void 0===o?{}:o,r="v1/".concat(e,"/");return tt.post({path:r,body:{data:ct(ct({},A),{},{Label:n})}})}},{key:"delete",value:function(t){var e=t.type,n=t.name,o=t.body,A="v1/".concat(e,"/").concat(n,"/");return tt.delete({path:A,body:o})}}]),t}(),at=n(5),st=n.n(at),ut=n(14),ht=n.n(ut),lt=n(15),ft=n.n(lt),dt=n(11),gt=n.n(dt);function Bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=gt()(t);if(e){var A=gt()(this).constructor;n=Reflect.construct(o,arguments,A)}else n=o.apply(this,arguments);return ft()(this,n)}}var Et=function(t){ht()(n,t);var e=Bt(n);function n(){var t;v()(this,n);for(var o=arguments.length,A=new Array(o),r=0;r<o;r++)A[r]=arguments[r];return t=e.call.apply(e,[this].concat(A)),w()(st()(t),"read",(function(){var e=st()(t),n=e.workspace,o=e.type,A=e.name,r=e.version,c="v2/db/".concat(n,"/").concat(o,"/").concat(A,"/").concat(r);return tt.get({path:c}).then((function(e){return t.data=e,e}))})),w()(st()(t),"update",(function(e){var n=st()(t),o=n.workspace,A=n.type,r=n.name,c=n.version,i="v2/db/".concat(o,"/").concat(A,"/").concat(r,"/").concat(c);return tt.put({path:i,body:e})})),w()(st()(t),"createSnapshot",(function(e){var n=e.trgWorkspace,o=e.version,A=st()(t),r=A.workspace,c=A.type,i=A.name;return Snapshot.create({trgWorkspace:n,srcWorkspace:r,type:c,name:i,version:o})})),w()(st()(t),"getSnapShots",(function(){var e=st()(t),n=e.workspace,o=e.type,A=e.name;return Snapshot.getAll({workspace:n,type:o,name:A})})),t}return C()(n,null,[{key:"create",value:function(t){var e=t.type,n=t.name,o=t.workspace,A="v2/db/".concat(o,"/").concat(e,"/").concat(n),r={Label:n};return tt.post({path:A,body:r})}},{key:"delete",value:function(t){var e=t.type,n=t.name,o=t.body,A=t.workspace,r="v2/db/".concat(void 0===A?"global":A,"/").concat(e,"/").concat(n);return tt.delete({path:r,body:o})}}]),n}(it);w()(Et,"getDocs",(function(t){var e=t.workspace,n=t.scope,o=t.id,A=n?"/".concat(n):"",r=n&&o?"/".concat(o):"",c="v2/db/".concat(e).concat(A).concat(r);return tt.get({path:c})}));var vt=Et,bt=function(t){return{v1:it,v2:vt}[t]},wt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return v()(this,t),new(bt(n))(e)}return C()(t,null,[{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return bt(e).create(t)}},{key:"delete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1";return bt(e).delete(t)}},{key:"parsePath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Node",n=t.split("/"),o=n.length>1?n[0]:"global",A=n[1]||e,r=n[2]||t,c=n[3]||"__UNVERSIONED__",i="".concat(o,"/").concat(A,"/").concat(r,"/").concat(c);return{workspace:o,type:A,name:r,version:c,path:i}}},{key:"exists",value:function(t){var e=t.name,n=t.scope,o=t.version,A=t.workspace,r="v2/db/".concat(void 0===A?"global":A,"/").concat(n,"/").concat(e,"/").concat(o);return tt.get({path:r}).then((function(t){return!!t[n]})).catch((function(t){return 500!==t.status}))}}]),t}(),pt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{IP:"",RobotName:""};v()(this,t),this.id=e,this.ip=n.IP,this.name=n.RobotName,this.data=n,this.logs=[],this.logger={status:l,timeout:null,time:3e3},this.logSubscriptions={},this.onGetIPCallback=function(){},this.api=new wt({workspace:"global",type:"Robot",name:this.id,version:"-"},"v2")}return C()(t,[{key:"subscribe",value:function(e){var n=e.property,o=e.propValue,A=void 0===o?"*":o,r=e.onLoad,c=void 0===r?function(){}:r,i=e.onUpdate,a=void 0===i?function(){}:i;J.subscribe(w()({Scope:t.SCOPE,Name:this.id},n,A),(function(t){return a(t)}),(function(t){return c(t)}))}},{key:"unsubscribe",value:function(e){var n=e.property,o=e.propValue,A=void 0===o?"*":o;J.unsubscribe(w()({Scope:t.SCOPE,Name:this.id},n,A))}},{key:"getData",value:function(){var t=this;this.api.read().then((function(e){var n,o=null==e||null===(n=e.Robot)||void 0===n?void 0:n[t.id];o&&(t.data=o,t.ip=o.IP,t.name=o.RobotName)}))}},{key:"getIP",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(""!==this.ip)return this.ip;this.onGetIPCallback=t,this.subscribe("IP",this._loadIP(this))}},{key:"startLogger",value:function(){this.logger.status=f,this._getLogs()}},{key:"stopLogger",value:function(){this.logger.status=d,clearTimeout(this.logger.timeout)}},{key:"subscribeToLogs",value:function(t){var e=M.randomGuid();return this.logSubscriptions[e]={send:t},this.logger.status!==f?this.startLogger():this.logs&&t(this.logs),e}},{key:"unsubscribeToLogs",value:function(t){t&&this.logSubscriptions[t]&&(delete this.logSubscriptions[t],0===Object.keys(this.logSubscriptions).length&&this.stopLogger())}},{key:"refreshLogs",value:function(){clearTimeout(this.logger.timeout),this._getLogs()}},{key:"_getLogs",value:function(){var t=this;if(0!==Object.keys(this.logSubscriptions).length&&this.logger.status===f&&this.ip){var e="http://".concat(this.ip,"/api/v1/logs/?level=info,error,warning,critical&limit=50&tags=ui");tt.get({url:e}).then((function(e){if(e&&e.data&&e.data.length){for(var n in t.logs=e.data,t.logSubscriptions)t.logSubscriptions[n].send(e.data);t._enqueueNextRequest()}})).catch((function(e){t.logger.time+=1e3,t._enqueueNextRequest()}))}}},{key:"_enqueueNextRequest",value:function(){var t=this;clearTimeout(this.logger.timeout),this.logger.timeout=setTimeout((function(){return t._getLogs()}),this.logger.time)}},{key:"_loadIP",value:function(t){return function(e){e.value?(t.ip=e.value.Robot[t.id].IP,t.onGetIPCallback(t.ip)):t.ip=null}}}]),t}();w()(pt,"SCOPE","Robot");var yt=pt,mt=n(16),It=n.n(mt),Mt=function(){function t(){var e=this;if(v()(this,t),w()(this,"_applyChanges",(function(t){Object.keys(t).forEach((function(n){var o=It()(t,n,{});e.robots[n]||(e.cachedRobots[n]=o,e.robots[n]=new yt(n,o)),Object.keys(o).forEach((function(t){e.cachedRobots[n][t]=o[t],e.robots[n].data[t]=o[t]}))}))})),Qt)return Qt;this.isDataLoaded=!1,this.subscribedOnDataLoad=[],this.subscribedOnDataChange=[],this.randomId=M.randomGuid(),this.robots={},this.cachedRobots={},this.subscribeToRedis(),this.destroy=function(){J.unsubscribe({Scope:"Robot",RobotName:"*",IP:"*"})},Qt=this}return C()(t,[{key:"subscribeToRedis",value:function(){var t=this;J.subscribe({Scope:"Robot",RobotName:"*",IP:"*"},(function(e){var n=e.key.Robot;t._applyChanges(n);var o={};Object.keys(n).forEach((function(e){o[e]=t.cachedRobots[e]})),t.subscribedOnDataChange.forEach((function(t){return t(o)}))}),(function(e){t.isDataLoaded=!0,e.value&&(t.cachedRobots=e.value.Robot,Object.keys(t.cachedRobots).forEach((function(e){t.robots[e]=new yt(e,t.cachedRobots[e])}))),t.subscribedOnDataLoad.forEach((function(e){return e(t.cachedRobots)}))}))}},{key:"subscribeToChanges",value:function(t){this.subscribedOnDataChange.push(t)}},{key:"getAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return this.isDataLoaded?t(this.cachedRobots):this.subscribedOnDataLoad.push(t),this.cachedRobots}},{key:"getRobot",value:function(t){if(this.robots[t])return this.robots[t];var e,n=this.cachedRobots[t];return(e=n?new yt(t,n):new yt(t)).getData(),this.robots[t]=e,e}}]),t}(),Qt=null,kt=Mt,Ct=u.getToken,St=u.AuthException,Tt=u.checkLogin,Dt=function t(){var e=this;v()(this,t),w()(this,"connect",(function(){e.websocket=new O({url:e.WS_API,onOpen:e.onOpen,onClose:e.onClose,onError:e.onError,onMessage:e.onMessage,connectionHandler:null}),e.websocket.createSocket()})),w()(this,"onOpen",(function(t){e.dispatch("onopen",void 0)})),w()(this,"onClose",(function(t){e.dispatch("onclose",void 0),1e3!==t.code&&window.setTimeout(e.connect(),e.timeout)})),w()(this,"onMessage",(function(t){var n;try{n=JSON.parse(t.data)}catch(t){return void console.error(t)}if(n.error)console.error(n.error);else{var o=n.patterns,A=!0,r=!1;["list","unsubscribe","subscribe"].includes(n.event)&&(o=o.map((function(t){return"unsubscribe"===n.event&&delete e.callbacks[JSON.stringify(t)],n.event+"/"+JSON.stringify(t)})),"list"===n.event&&(o=["list"]),A=!1,r=!0),o.map((function(t){e.dispatch(t,n,A,r)}))}})),w()(this,"checkTest",(function(t,n,o,A){return new Promise((function(r,c){e.dispatch(t,n,o,A),r("DONE")}))})),w()(this,"onError",(function(t){e.dispatch("onerror",void 0)})),w()(this,"onEvent",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;e.evt_callbacks[t]=e.evt_callbacks[t]||[],e.evt_callbacks[t].push(n)})),w()(this,"close",(function(){return e.websocket.close()})),w()(this,"subscribe",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A={event:"subscribe",pattern:t},r=JSON.stringify(t);e.callbacks[r]=e.callbacks[r]||[],e.callbacks[r].push(n),o&&(e.evt_callbacks["subscribe/"+r]=e.evt_callbacks["subscribe"+r]||[],e.evt_callbacks["subscribe/"+r].push(o)),e._send(A)})),w()(this,"unsubscribe",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;console.log("Unsubscribe called "+JSON.stringify(t));var o={event:"unsubscribe",pattern:t},A=JSON.stringify(t);n&&(e.evt_callbacks["unsubscribe/"+A]=e.evt_callbacks["unsubscribe/"+A]||[],e.evt_callbacks["unsubscribe/"+A].push(n)),e._send(o)})),w()(this,"list",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n={event:"list"};e.evt_callbacks.list=e.evt_callbacks.list||[],e.evt_callbacks.list.push(t),e._send(n)})),w()(this,"_send",(function(t){e.websocket.send(JSON.stringify(t))})),w()(this,"dispatch",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=void 0,c=t;if(!0===o?(c=JSON.stringify(t),r=e.callbacks[c]):r=e.evt_callbacks[c],void 0!==r){for(var i=0;i<r.length;i++)"function"==typeof r[i]&&r[i](n);r&&!0===A&&(r=[])}})),w()(this,"getVar",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";if(!["global","fleet"].includes(o))throw"Only fleet and global scopes available.";if("fleet"===o&&t.split("@").length<2)throw"Wrong key format (robot_name@key_name)";var A=e.REST_API+"database/"+o+"/"+t+"/";Tt().then((function(t){fetch(A).then((function(t){return t.json()})).then((function(t){n&&n(t)})).catch((function(t){console.log(t)}))}))})),w()(this,"setVar",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"global";if(!["global","fleet"].includes(A))throw"Only fleet and global scopes available.";if("fleet"===A){t.split("@");if(t.split("@").length<2)throw"Wrong key format (robot_name@key_name)"}var r={key:t,scope:A,value:n},c=e.REST_API+"database/";Tt().then((function(t){if(!t)throw new St("login error");fetch(c,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){o&&o(t)})).catch((function(t){console.log(t)}))}))})),w()(this,"get",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Tt().then((function(n){if(!n)throw new St("login error");fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){e&&t.json().then((function(n){e(n,t)})).catch((function(t){e(void 0,t)}))}))}))})),w()(this,"post",(function(t,n,o,A){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=e.REST_API+t+"/"+n+"/";void 0===n&&(c=e.REST_API+t+"/"),Tt().then((function(t){if(!t)throw new St("login error");fetch(c,{method:"POST",body:JSON.stringify({key:o,data:A}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){r&&t.json().then((function(e){r(e,t)})).catch((function(t){r(void 0,t)}))}))}))})),w()(this,"upload",(function(t,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r="".concat(e.REST_API,"upload/").concat(t,"/"),c=new FormData;c.append("name",n),c.append("data",o),fetch(r,{method:"POST",body:c}).then((function(t){return t.json()})).then(A).catch((function(t){console.log("upload error",t),A(void 0)}))})),w()(this,"put",(function(t,n,o){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=e.REST_API+t+"/"+n+"/";console.log("database put",r),void 0===n&&(r=e.REST_API+t+"/"),Tt().then((function(t){if(!t)throw new St("login error");fetch(r,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){A&&t.json().then((function(e){A(e,t)})).catch((function(e){A(void 0,t)}))}))}))})),w()(this,"delete",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=e.REST_API+t+"/"+n+"/";void 0!==n?Tt().then((function(t){if(!t)throw new St("login error");fetch(r,{method:"DELETE",body:JSON.stringify(A),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){o&&t.json().then((function(e){o(e,t)})).catch((function(e){o(void 0,t)}))}))})):r=e.REST_API+t+"/"})),w()(this,"cloudFunction",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;Tt().then((function(r){if(!r)throw new St("login error");var c=e.REST_API+"function/"+t+"/";fetch(c,{method:"POST",body:JSON.stringify({func:n,args:o}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){A&&t.json().then((function(t){return A(t)})).catch((function(t){console.log(t),A(void 0)}))}))}))})),w()(this,"postTabs",(function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,A="User",r=e.REST_API+A+"/"+t+"/";if(void 0!==t){var c=n.map((function(t){return{componentName:t.componentName,name:t.name}})),i={Workspace:"*"};Tt().then((function(t){fetch(r,{method:"POST",body:JSON.stringify({key:i,data:c}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ct())}}).then((function(t){o&&t.json().then((function(e){o(e,t)})).catch((function(e){o(void 0,t)}))}))}))}else r=e.REST_API+A+"/"})),this.host="".concat(window.location.hostname,":").concat(window.location.port);var n="https:"===window.location.protocol;this.WS_API="".concat(n?"wss":"ws","://").concat(this.host,"/ws/subscriber"),this.REST_API="".concat(window.location.protocol,"//").concat(this.host,"/api/v1/"),this.callbacks={},this.evt_callbacks={},this.timeout=3e3,this.websocket=void 0,this.connect()},Ot="\n@font-face {\n  font-family: 'mov.ai';\n  src: url(".concat("data:font/woff;base64,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",') format("woff");\n  font-weight: normal;\n  font-style: normal;\n  font-display: block;\n}\n\n[class^="icon-"], [class*=" icon-"] {\n  /* use !important to prevent issues with browser extensions that change fonts */\n  font-family: \'mov.ai\' !important;\n  speak: none;\n  font-style: normal;\n  font-weight: normal;\n  font-variant: normal;\n  text-transform: none;\n  line-height: 1;\n\n  /* Better Font Rendering =========== */\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.icon-widget:before {\n  content: "\\e900";\n}\n.icon-tree:before {\n  content: "\\e903";\n}\n.icon-Statistics:before {\n  content: "\\e906";\n}\n.icon-Scenes:before {\n  content: "\\e907";\n}\n.icon-Sad:before {\n  content: "\\e908";\n}\n.icon-repeat:before {\n  content: "\\e909";\n}\n.icon-packages:before {\n  content: "\\e90c";\n}\n.icon-outline-off:before {\n  content: "\\e90d";\n}\n.icon-outline:before {\n  content: "\\e90e";\n}\n.icon-out:before {\n  content: "\\e90f";\n}\n.icon-Nodes:before {\n  content: "\\e911";\n}\n.icon-Layouts:before {\n  content: "\\e913";\n}\n.icon-info:before {\n  content: "\\e914";\n}\n.icon-in:before {\n  content: "\\e915";\n}\n.icon-Happy:before {\n  content: "\\e916";\n}\n.icon-grid:before {\n  content: "\\e917";\n}\n.icon-Filters:before {\n  content: "\\e918";\n}\n.icon-expand_more:before {\n  content: "\\e919";\n}\n.icon-expand_less:before {\n  content: "\\e91a";\n}\n.icon-Empty:before {\n  content: "\\e91b";\n}\n.icon-edit:before {\n  content: "\\e91c";\n}\n.icon-drag_indicator:before {\n  content: "\\e91d";\n}\n.icon-download:before {\n  content: "\\e91e";\n}\n.icon-details:before {\n  content: "\\e91f";\n}\n.icon-delete:before {\n  content: "\\e920";\n}\n.icon-create_new_folder:before {\n  content: "\\e921";\n}\n.icon-chevron_right:before {\n  content: "\\e923";\n}\n.icon-chevron_left:before {\n  content: "\\e924";\n}\n.icon-heck_circle:before {\n  content: "\\e925";\n}\n.icon-carts:before {\n  content: "\\e926";\n}\n.icon-Callbacks:before {\n  content: "\\e928";\n}\n.icon-Annotations:before {\n  content: "\\e929";\n}\n.icon-add:before {\n  content: "\\e92b";\n}\n'),Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;v()(this,t),this.size=e,this.undoStack=new jt(e),this.redoStack=new jt(e)}return C()(t,[{key:"doIt",value:function(t){t.doAction(),this.undoStack.push(t),this.redoStack=new jt(this.size)}},{key:"addIt",value:function(t){this.undoStack.push(t),this.redoStack=new jt(this.size)}},{key:"undo",value:function(t){var e=this.undoStack.pop();e&&(e.undoAction(t),this.redoStack.push(e))}},{key:"redo",value:function(t){var e=this.redoStack.pop();e&&(e.doAction(t),this.undoStack.push(e))}}],[{key:"actionBuilder",value:function(){return new Ut}}]),t}(),Ut=function(){function t(){v()(this,t),this._doAction=null,this._undoAction=null}return C()(t,[{key:"doAction",value:function(t){return this._doAction=t,this}},{key:"undoAction",value:function(t){return this._undoAction=t,this}},{key:"build",value:function(){if([this._undoAction,this._undoAction].some((function(t){return null==t})))throw"Forgot to set doAction or undoAction";return{doAction:this._doAction,undoAction:this._undoAction}}}]),t}(),jt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;v()(this,t),this.size=e,this.queue=[]}return C()(t,[{key:"push",value:function(t){this.queue.length===this.size&&this.queue.shift(),this.queue.push(t)}},{key:"pop",value:function(){return this.queue.pop()}}]),t}(),Nt=function(){function t(){if(v()(this,t),t.instance)return t.instance;t.instance=this,this._data={},this.copyKey=Math.random()}return C()(t,[{key:"data",get:function(){return this._data}}],[{key:"clear",value:function(e){var n=new t;e&&delete n._data[e]}},{key:"read",value:function(e){var n=new t;return e?n.data[e]:n.data}},{key:"write",value:function(e,n){return(new t)._data[e]=n}},{key:"copy",value:function(e){t.write((new t).copyKey,e)}},{key:"paste",value:function(){return t.read((new t).copyKey)}}]),t}(),Ft=function t(){var e=this;v()(this,t),w()(this,"getData",(function(){var t={"Content-Type":"application/json",Authorization:"Bearer ".concat(u.getToken())},n=e.tokenData.message.name,o="".concat(e.baseUrl,"/").concat(n,"/");return new Promise((function(n,A){var r=(new Date).getTime();if(r-e.timestamp<=e.TIMEOUT&&e.data)return n({response:e.data});e.timestamp=r,fetch(o,{headers:t}).then((function(t){t.ok||A({error:t.statusText}),t.json().then((function(t){e.data=t,n({response:t})})).catch((function(t){e.data=null,A({error:t})}))})).catch((function(t){e.data=null,A({error:t})}))}))})),w()(this,"isSuperUser",A()(c.a.mark((function t(){var n,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getData();case 2:return o=t.sent,t.abrupt("return",(null==o||null===(n=o.response)||void 0===n?void 0:n.Superuser)||!1);case 4:case"end":return t.stop()}}),t)})))),this.baseUrl="".concat(window.location.origin,"/api/v1/User"),this.tokenData=u.getTokenData(),this.data=null,this.timestamp=null,this.TIMEOUT=3e3},xt=function(){function t(){var e=this;v()(this,t),w()(this,"_initialize",(function(){if(ot.a.isEmpty(e.models))throw new Error("No models added");return Object.keys(e.models).forEach((function(t){var n=t.charAt(0).toLowerCase()+t.slice(1);Object.defineProperty(e,n,{get:function(){return e.models[t]}})})),e._subscribeModelsReady()})),w()(this,"_subscribeModelsReady",(function(){return Object.keys(e.models).forEach((function(t){e.models[t].onReady((function(){return e._setModelReady(t)}))})),e})),w()(this,"_setModelReady",(function(t){e.isReady+=1,e.isReady===Object.keys(e.models).length&&e._subject_state.complete()})),w()(this,"onUpdate",(function(t,e){return t.onUpdate(e)})),w()(this,"onReady",(function(t){e.db_state!==e.db_states.ready?e._subject_state.subscribe((function(){}),(function(){}),(function(){return t()})):t()})),this.models={},this.db_states=Object.freeze({error:-1,loading:0,ready:1}),this.isReady=0,this._subject_state=new et.BehaviorSubject(0)}return C()(t,[{key:"db_state",get:function(){return this.isReady===Object.keys(this.models).length?this.db_states.ready:this.db_states.loading}}]),t}(),Yt={create:function(){throw new Error("Not implemented")},delete:function(){throw new Error("Not implemented")},getAll:function(){return tt.get({path:"v2/db"})},getDocs:function(t){var e=t.workspace,n=t.scope,o=t.id,A=n?"/".concat(n):"",r=n&&o?"/".concat(o):"",c="v2/db/".concat(e).concat(A).concat(r);return tt.get({path:c})}},Pt=Yt,_t={_create:function(t){var e=t.target,n=t.body,o=void 0===n?{}:n,A=e.workspace,r=e.type,c=e.name,i=e.version,a="v2/db/".concat(A,"/").concat(r,"/").concat(c,"/").concat(i);return tt.post({path:a,body:o})},create:function(t){var e=t.target,n=t.body,o=void 0===n?{}:n;_t._create({target:e,body:{data:o}})},createByRef:function(t){var e=t.target,n=t.source,o={src:"".concat(n.workspace,"/").concat(n.type,"/").concat(n.name,"/").concat(n.version)};return _t._create({target:e,source:n,body:o})},delete:function(){throw new Error("Not implemented")},read:function(t){var e=t.workspace,n=t.type,o=t.name,A=t.version,r="v2/db/".concat(e,"/").concat(n,"/").concat(o,"/").concat(A);return tt.get({path:r})},restore:function(t){var e=t.target,n=t.source;return e.workspace="global",_t.createByRef({target:e,source:n})},getAll:function(t){var e=t.workspace,n=t.type,o=t.name,A="v2/db/".concat(e,"/").concat(n,"/").concat(o);return tt.get({path:A})}},Vt=_t}])}));
//# sourceMappingURL=index.js.map